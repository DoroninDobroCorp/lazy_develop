—Å–µ–π—á–∞—Å —è –≤—ã–≥—Ä—É–∂—É —Ç–µ–±—è —Å–Ω–∞—á–∞–ª–∞ –¥–µ—Ä–µ–≤–æ —Ñ–∞–π–ª–æ–≤ —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏ –≤ —Å–∏–º–≤–æ–ª–∞—Ö, –∞ –ø–æ—Ç–æ–º –≤—Å–µ —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –±—ã–ª–∏ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω—ã. –í–æ–∑–º–æ–∂–Ω–æ —ç—Ç–æ –∑–∞–π–º–µ—Ç –±–æ–ª—å—à–µ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è, —Ç–æ–≥–¥–∞ –ø—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏ –û–ö. –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤—Å–µ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ, —è –∑–∞–¥–∞–º –≤–æ–ø—Ä–æ—Å—ã, —á—Ç–æ–±—ã —Ç—ã –±—ã–ª –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∫–æ–¥–∞.

--- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (—Å —Ä–∞–∑–º–µ—Ä–∞–º–∏ –≤ —Å–∏–º–≤–æ–ª–∞—Ö) ---

[DIR] lazy_develop/ (155899 chars)
  [FILE] colors.py (6743 chars)
  [FILE] context_collector.py (6395 chars)
  !!![FILE] sloth_cli.py (24358 chars)
  !!![FILE] sloth_core.py (20500 chars)
  [FILE] sloth_history.json (637 chars)
  !!![FILE] sloth_run.log (92510 chars)
  [FILE] sloth_runner.py (4756 chars)

--- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–æ–≤ ---


–§–∞–π–ª: colors.py
---------------
"""
–§–∞–π–ª: colors.py

–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ –¥–ª—è –∫–æ–Ω—Å–æ–ª–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å–≤–µ—Ç–ª—ã—Ö –∏ —Ç–µ–º–Ω—ã—Ö —Ç–µ–º.

–ö–∞–∫ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–µ–º–æ–π:
- SLOTH_THEME=dark | light | mono (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: auto‚Üílight)
- NO_COLOR (–ª—é–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ) ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∞–µ—Ç —Ü–≤–µ—Ç–∞

–ü–∞–ª–∏—Ç—Ä—ã –ø–æ–¥–æ–±—Ä–∞–Ω—ã –≤ –º—è–≥–∫–æ–º –ø–∞—Å—Ç–µ–ª—å–Ω–æ–º —Å—Ç–∏–ª–µ —Å —É—á–µ—Ç–æ–º —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –Ω–∞ —Å–≤–µ—Ç–ª–æ–º –∏ —Ç–µ–º–Ω–æ–º —Ñ–æ–Ω–µ.
"""

import os
import sys
import locale


def _rgb(r: int, g: int, b: int) -> str:
    return f"\033[38;2;{r};{g};{b}m"


def _supports_truecolor() -> bool:
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É 24-–±–∏—Ç–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–º.

    –ù–∞–¥–µ–∂–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è COLORTERM=truecolor|24bit.
    –ù–∞ macOS –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã –Ω–µ —É–∫–∞–∑—ã–≤–∞—é—Ç —ç—Ç–æ —è–≤–Ω–æ, –ø–æ—ç—Ç–æ–º—É
    –¥–æ–ø—É—Å–∫–∞–µ–º —Ä—É—á–Ω–æ–π –æ–≤–µ—Ä—Ä–∞–π–¥ —á–µ—Ä–µ–∑ SLOTH_COLOR_DEPTH=24.
    """
    ct = (os.getenv("COLORTERM") or "").lower()
    if "truecolor" in ct or "24bit" in ct:
        return True
    if (os.getenv("SLOTH_COLOR_DEPTH") or "").strip() == "24":
        return True
    return False


def _supports_256color() -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É 256-—Ü–≤–µ—Ç–Ω–æ–π –ø–∞–ª–∏—Ç—Ä—ã.

    –û—Ä–∏–µ–Ω—Ç–∏—Ä—É–µ–º—Å—è –Ω–∞ TERM, –∞ —Ç–∞–∫–∂–µ –¥–æ–ø—É—Å–∫–∞–µ–º —Ä—É—á–Ω–æ–π –æ–≤–µ—Ä—Ä–∞–π–¥ SLOTH_COLOR_DEPTH=256.
    """
    if (os.getenv("SLOTH_COLOR_DEPTH") or "").strip() == "256":
        return True
    term = (os.getenv("TERM") or "").lower()
    return "256color" in term or "xterm" in term or "screen" in term


def _should_enable_ansi() -> bool:
    if os.getenv("NO_COLOR"):
        return False
    if os.getenv("TERM", "").lower() == "dumb":
        return False
    try:
        return sys.stdout.isatty()
    except Exception:
        return False


def _resolve_theme() -> str:
    theme = (os.getenv("SLOTH_THEME") or "auto").strip().lower()
    if theme in ("dark", "light", "mono"):
        return theme
    # –ê–≤—Ç–æ-—Ä–µ–∂–∏–º: –±–µ–∑ –Ω–∞–¥–µ–∂–Ω–æ–≥–æ —Å–ø–æ—Å–æ–±–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ñ–æ–Ω ‚Äî –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ–º 'light'
    return "light"


class Colors:
    """ANSI-–∫–æ–¥—ã —Ü–≤–µ—Ç–æ–≤, –∑–∞–≤–∏—Å—è—â–∏–µ –æ—Ç —Ç–µ–º—ã –∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è."""

    _ENABLED = _should_enable_ansi()
    _THEME = _resolve_theme()
    _TRUECOLOR = _supports_truecolor()
    _ANSI256 = _supports_256color()

    # –ü–∞—Å—Ç–µ–ª—å–Ω—ã–µ, –Ω–æ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–µ –ø–∞–ª–∏—Ç—Ä—ã –¥–ª—è 24-bit
    _PALETTE_DARK_24 = {
        "FAIL": _rgb(191, 97, 106),      # –º—è–≥–∫–∏–π –∫—Ä–∞—Å–Ω—ã–π
        "OKGREEN": _rgb(163, 190, 140),  # –º—è–≥–∫–∏–π –∑–µ–ª–µ–Ω—ã–π
        "WARNING": _rgb(235, 203, 139),  # —Ç–µ–ø–ª—ã–π –∂–µ–ª—Ç—ã–π
        "OKBLUE": _rgb(94, 129, 172),    # —Ö–æ–ª–æ–¥–Ω—ã–π —Å–∏–Ω–∏–π
        "HEADER": _rgb(180, 142, 173),   # –ø–∞—Å—Ç–µ–ª—å–Ω—ã–π –ø—É—Ä–ø—É—Ä
        "CYAN": _rgb(136, 192, 208),     # —Å–ø–æ–∫–æ–π–Ω—ã–π —Ü–∏–∞–Ω
        "GREY": _rgb(106, 114, 128),     # –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä—ã–π
    }

    _PALETTE_LIGHT_24 = {
        # –ë–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ –Ω–∞ —Å–≤–µ—Ç–ª–æ–º —Ñ–æ–Ω–µ ‚Äî —Å–ª–µ–≥–∫–∞ –∑–∞—Ç–µ–º–Ω–µ–Ω–Ω—ã–µ, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞—Å—Ç–µ–ª—å–Ω—ã–π —Ç–æ–Ω
        "FAIL": _rgb(170, 40, 55),       # –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∏–π –∫—Ä–∞—Å–Ω—ã–π
        "OKGREEN": _rgb(88, 133, 96),    # –±–æ–ª–µ–µ —Ç–µ–º–Ω—ã–π –∑–µ–ª—ë–Ω—ã–π
        "WARNING": _rgb(152, 110, 0),    # —è–Ω—Ç–∞—Ä–Ω—ã–π/–æ—Ö—Ä–∞
        "OKBLUE": _rgb(36, 71, 120),     # —Ç–µ–º–Ω–æ-–≥–æ–ª—É–±–æ–π
        "HEADER": _rgb(120, 70, 120),    # –≥–ª—É–±–æ–∫–∏–π –ø—É—Ä–ø—É—Ä
        "CYAN": _rgb(20, 110, 130),      # —Ç–µ–º–Ω—ã–π —Ü–∏–∞–Ω
        "GREY": _rgb(80, 86, 98),        # –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π —Å–µ—Ä—ã–π
    }

    # –ü–∞—Å—Ç–µ–ª—å–Ω–∞—è 256-—Ü–≤–µ—Ç–Ω–∞—è –ø–∞–ª–∏—Ç—Ä–∞ (–ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è –∫ 24-bit –∑–Ω–∞—á–µ–Ω–∏—è–º)
    def _c256(n: int) -> str:
        return f"\033[38;5;{n}m"

    _PALETTE_DARK_256 = {
        "FAIL": _c256(174),     # –º—è–≥–∫–∏–π –∫—Ä–∞—Å–Ω—ã–π
        "OKGREEN": _c256(114),  # –º—è–≥–∫–∏–π –∑–µ–ª–µ–Ω—ã–π
        "WARNING": _c256(180),  # —Ç–µ–ø–ª—ã–π –∂–µ–ª—Ç—ã–π
        "OKBLUE": _c256(110),   # —Ö–æ–ª–æ–¥–Ω—ã–π —Å–∏–Ω–∏–π
        "HEADER": _c256(176),   # –ø–∞—Å—Ç–µ–ª—å–Ω—ã–π –ø—É—Ä–ø—É—Ä
        "CYAN": _c256(109),     # —Å–ø–æ–∫–æ–π–Ω—ã–π —Ü–∏–∞–Ω
        "GREY": _c256(246),     # –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä—ã–π
    }

    _PALETTE_LIGHT_256 = {
        # –ß—É—Ç—å –±–æ–ª–µ–µ —Ç—ë–º–Ω—ã–µ –ø–∞—Å—Ç–µ–ª—å–Ω—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏ –¥–ª—è —Å–≤–µ—Ç–ª–æ–≥–æ —Ñ–æ–Ω–∞
        "FAIL": _c256(167),
        "OKGREEN": _c256(108),
        "WARNING": _c256(178),
        "OKBLUE": _c256(67),
        "HEADER": _c256(139),
        "CYAN": _c256(73),
        "GREY": _c256(238),  # —Ç—ë–º–Ω–æ-—Å–µ—Ä—ã–π –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
    }

    # –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è 8-—Ü–≤–µ—Ç–Ω–∞—è –ø–∞–ª–∏—Ç—Ä–∞ (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
    # –í–∞–∂–Ω–∞—è –¥–µ—Ç–∞–ª—å: –Ω–∞ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ –¥–µ–ª–∞–µ–º GREY = —á—ë—Ä–Ω—ã–π (30), —á—Ç–æ–±—ã –Ω–µ –±—ã–ª —Å–ª–∏—à–∫–æ–º –±–ª–µ–¥–Ω—ã–º
    _PALETTE_DARK_8 = {
        "FAIL": "\033[31m",     # red
        "OKGREEN": "\033[32m",  # green
        "WARNING": "\033[33m",  # yellow
        "OKBLUE": "\033[34m",   # blue
        "HEADER": "\033[35m",  # magenta
        "CYAN": "\033[36m",    # cyan
        "GREY": "\033[90m",    # bright black (grey)
    }

    _PALETTE_LIGHT_8 = {
        "FAIL": "\033[31m",
        "OKGREEN": "\033[32m",
        "WARNING": "\033[33m",
        "OKBLUE": "\033[34m",
        "HEADER": "\033[35m",
        "CYAN": "\033[36m",
        "GREY": "\033[30m",    # –æ–±—ã—á–Ω—ã–π —á—ë—Ä–Ω—ã–π –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –Ω–∞ –±–µ–ª–æ–º
    }

    if _ENABLED and _THEME != "mono":
        if _TRUECOLOR:
            _P = _PALETTE_LIGHT_24 if _THEME == "light" else _PALETTE_DARK_24
        elif _ANSI256:
            _P = _PALETTE_LIGHT_256 if _THEME == "light" else _PALETTE_DARK_256
        else:
            _P = _PALETTE_LIGHT_8 if _THEME == "light" else _PALETTE_DARK_8
        FAIL = _P["FAIL"]
        OKGREEN = _P["OKGREEN"]
        WARNING = _P["WARNING"]
        OKBLUE = _P["OKBLUE"]
        HEADER = _P["HEADER"]
        CYAN = _P["CYAN"]
        GREY = _P["GREY"]
        BOLD = "\033[1m"
        UNDERLINE = "\033[4m"
        ENDC = "\033[0m"
    else:
        # –ú–æ–Ω–æ —Ä–µ–∂–∏–º –∏–ª–∏ —Ü–≤–µ—Ç–∞ –æ—Ç–∫–ª—é—á–µ–Ω—ã
        FAIL = ""
        OKGREEN = ""
        WARNING = ""
        OKBLUE = ""
        HEADER = ""
        CYAN = ""
        GREY = ""
        BOLD = "" if os.getenv("NO_COLOR") else "\033[1m"
        UNDERLINE = "" if os.getenv("NO_COLOR") else "\033[4m"
        ENDC = ""


def _supports_emoji() -> bool:
    """–≠–≤—Ä–∏—Å—Ç–∏–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —ç–º–æ–¥–∑–∏.

    - –ú–æ–∂–Ω–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤—ã–∫–ª—é—á–∏—Ç—å: SLOTH_EMOJI=0
    - –ú–æ–∂–Ω–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∏—Ç—å: SLOTH_EMOJI=1
    - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: –≤–∫–ª—é—á–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–æ–¥–∏—Ä–æ–≤–∫–∞ stdout –∏ locale ‚Äî UTF-8.
    """
    env = os.getenv("SLOTH_EMOJI")
    if env == "0":
        return False
    if env == "1":
        return True
    encs = [getattr(sys.stdout, "encoding", ""), locale.getpreferredencoding(False)]
    return any(e and "utf" in e.lower() for e in encs)


class Symbols:
    """–ù–∞–±–æ—Ä —Å–∏–º–≤–æ–ª–æ–≤ —Å —Ñ–æ–ª–±—ç–∫–æ–º –Ω–∞ ASCII –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —ç–º–æ–¥–∑–∏."""

    _EMOJI = _supports_emoji()

    if _EMOJI:
        CHECK = "‚úÖ"
        CROSS = "‚ùå"
        INFO = "‚ÑπÔ∏è"
        GEAR = "‚öôÔ∏è"
        SAVE = "üíæ"
        BLUE_DOT = "üîµ"
        ROCKET = "üöÄ"
        WARNING = "‚ö†Ô∏è"
        FLAG = "üèÅ"
        SPINNER = "üîÑ"
    else:
        CHECK = "[OK]"
        CROSS = "[ERR]"
        INFO = "[i]"
        GEAR = "[cfg]"
        SAVE = "[save]"
        BLUE_DOT = "[¬∑]"
        ROCKET = ">>"
        WARNING = "[!]"
        FLAG = "[end]"
        SPINNER = "[~]"

–§–∞–π–ª: context_collector.py
--------------------------
# –§–∞–π–ª: context_collector.py
import os
import re

# --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –°–ë–û–†–ê –ö–û–ù–¢–ï–ö–°–¢–ê ---
IGNORE_EXTENSIONS = {".png", ".jpeg", ".jpg", ".gif", ".bmp", ".ico", ".svg", ".webp"}
IGNORE_FILES = {
    "go.mod", "go.sum", "package-lock.json", "yarn.lock",
    ".ds_store", ".gitignore", "readme.md", "analyzer_wide", "tsconfig.tsbuildinfo",
    "sloth_debug_prompt.txt", "sloth_debug_bad_response.txt"
}
IGNORE_DIRS = {
    "venv", ".venv", "__pycache__", ".pytest_cache", "node_modules",
    ".next", "dist", "build", "coverage", ".git", ".idea", ".vscode",
    ".claude", "logs"
}

# --- –ü–†–ò–í–ê–¢–ù–´–ï –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ---

def _get_file_content(filepath):
    """–ë–µ–∑–æ–ø–∞—Å–Ω–æ —á–∏—Ç–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞."""
    try:
        with open(filepath, "r", encoding="utf-8", errors="replace") as f:
            return f.read()
    except Exception:
        return None

def _summarize_content(content, filepath):
    """–°–æ–∫—Ä–∞—â–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞, –æ—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã–µ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã."""
    filename = os.path.basename(filepath)
    _, extension = os.path.splitext(filename)
    extension = extension.lower()

    if extension == '.py':
        matches = re.findall(r"^(?:@.*?\n)*(?:async\s+)?def\s+.*?\)|class\s+.*?:", content, re.MULTILINE)
        if matches:
            summary = [m + "\n    ... # implementation" for m in matches]
            return f"# File: {filename}\n# Summary of declarations:\n\n" + "\n\n".join(summary)
        return f"# File: {filename}\n# No top-level functions or classes found."

    elif extension in ['.js', '.jsx', '.ts', '.tsx']:
        matches = re.findall(r"^(?:export\s+)?(?:async\s+)?function\s+.*?\{|^(?:export\s+)?class\s+.*?\{|^(?:export\s+)?(?:const|let|var)\s+.*?=.*?;|^(?:export\s+)?type\s+.*?=.*?;|^(?:export\s+)?interface\s+.*?\{", content, re.MULTILINE)
        if matches:
            summary = [m + ("\n  // ... implementation\n}" if m.endswith('{') else "") for m in matches]
            return f"// File: {filename}\n// Summary of declarations:\n\n" + "\n\n".join(summary)
        return f"// File: {filename}\n// No top-level declarations found."
        
    elif extension in ['.html', '.css', '.scss', '.json', '.yml', '.yaml', '.xml', '.md']:
         lines = content.splitlines()
         if len(lines) > 20:
             summary = "\n".join(lines[:10]) + "\n\n[... content truncated ...]\n\n" + "\n".join(lines[-5:])
             return summary
         return content

    else:
        lines = content.splitlines()
        if len(lines) > 20:
            return f"[Content of file {filename} truncated. First 10 lines:]\n" + "\n".join(lines[:10])
        return content

def _should_ignore(path, root_dir):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–ª–µ–¥—É–µ—Ç –ª–∏ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª –∏–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é."""
    path_lower = path.lower()
    base_name = os.path.basename(path_lower)
    sloth_scripts = {
        "sloth.py"
    }
    if base_name in sloth_scripts: return True
    if base_name in IGNORE_FILES: return True
    if any(base_name.endswith(ext) for ext in IGNORE_EXTENSIONS): return True
    rel_path = os.path.relpath(path_lower, root_dir)
    path_parts = rel_path.split(os.sep)
    if any(part in IGNORE_DIRS for part in path_parts): return True
    return False

# --- –ì–õ–ê–í–ù–ê–Ø –ü–£–ë–õ–ò–ß–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø ---

def gather_project_context(root_dir, mode='full', full_content_files=None, top_n_files=3):
    """
    –°–∫–∞–Ω–∏—Ä—É–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞, —Å–æ–±–∏—Ä–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ –≤ –≤–∏–¥–µ –æ–¥–Ω–æ–π –±–æ–ª—å—à–æ–π —Å—Ç—Ä–æ–∫–∏.
    """
    if full_content_files is None: full_content_files = set()
    else: full_content_files = {os.path.normpath(os.path.join(root_dir, f)) for f in full_content_files}

    all_lines = []
    file_sizes = {}
    file_paths_to_include = []

    for dirpath, dirnames, filenames in os.walk(root_dir, topdown=True):
        dirnames[:] = [d for d in dirnames if not _should_ignore(os.path.join(dirpath, d), root_dir)]
        for filename in sorted(filenames):
            filepath = os.path.join(dirpath, filename)
            if _should_ignore(filepath, root_dir): continue
            content = _get_file_content(filepath)
            if content is not None:
                file_sizes[filepath] = len(content)
                file_paths_to_include.append(filepath)

    sorted_by_size = sorted(file_sizes.items(), key=lambda item: item[1], reverse=True)
    top_files_set = {filepath for filepath, size in sorted_by_size[:top_n_files]}
    
    tree_structure = {}
    for path in file_paths_to_include:
        rel_path = os.path.relpath(path, root_dir)
        parts = rel_path.split(os.sep)
        node = tree_structure
        for part in parts[:-1]: node = node.setdefault(part, {})
        node[parts[-1]] = path

    def generate_tree_lines_recursive(subtree, prefix=""):
        lines = []
        entries = sorted(subtree.items(), key=lambda item: isinstance(item[1], dict), reverse=True)
        for i, (name, value) in enumerate(entries):
            connector = "‚îî‚îÄ‚îÄ " if i == len(entries) - 1 else "‚îú‚îÄ‚îÄ "
            if isinstance(value, dict):
                lines.append(f"{prefix}{connector}{name}/")
                lines.extend(generate_tree_lines_recursive(value, prefix + ("    " if i == len(entries) - 1 else "‚îÇ   ")))
            else:
                size = file_sizes.get(value, 0)
                marker = "!!!" if value in top_files_set else ""
                lines.append(f"{prefix}{connector}{marker}{name} ({size} chars)")
        return lines
    tree_string = f"{os.path.basename(root_dir)}/\n" + "\n".join(generate_tree_lines_recursive(tree_structure))

    all_lines.append("–°–µ–π—á–∞—Å —è –≤—ã–≥—Ä—É–∂—É –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞: —Å–Ω–∞—á–∞–ª–∞ –¥–µ—Ä–µ–≤–æ —Ñ–∞–π–ª–æ–≤ —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏ –≤ —Å–∏–º–≤–æ–ª–∞—Ö, –∞ –ø–æ—Ç–æ–º –∏—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ.")
    all_lines.append("\n--- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ ---\n" + tree_string)
    all_lines.append("\n--- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–æ–≤ ---")

    for path in sorted(file_paths_to_include):
        rel_path = os.path.relpath(path, root_dir)
        all_lines.append(f"\n–§–∞–π–ª: {rel_path}\n{'-' * len('–§–∞–π–ª: ' + rel_path)}")
        content = _get_file_content(path)
        if content is None:
            all_lines.append("–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞.")
            continue
        norm_path = os.path.normpath(path)
        if mode == 'full' or norm_path in full_content_files:
            all_lines.append(content)
        else:
            all_lines.append(_summarize_content(content, path))
            
    return "\n".join(all_lines)

–§–∞–π–ª: sloth_cli.py
------------------
# –§–∞–π–ª: sloth_cli.py
import os
import sys
import time
import re
import json
import platform
import subprocess
import argparse
from tkinter import Tk, filedialog
import uuid

from colors import Colors, Symbols
import sloth_core
import sloth_runner
import context_collector

# --- –ö–û–ù–°–¢–ê–ù–¢–´ –ò–ù–¢–ï–†–§–ï–ô–°–ê ---
MAX_ITERATIONS = 20
HISTORY_FILE_NAME = 'sloth_history.json'
RUN_LOG_FILE_NAME = 'sloth_run.log'

def calculate_cost(model_name, input_tokens, output_tokens):
    pricing_info = sloth_core.MODEL_PRICING.get(model_name)
    if not pricing_info:
        return 0.0
    total_cost = 0.0
    input_tiers = pricing_info.get("input", {}).get("tiers", [])
    for tier in input_tiers:
        if input_tokens <= tier["up_to"]:
            total_cost += (tier["price"] / 1_000_000) * input_tokens
            break
    output_tiers = pricing_info.get("output", {}).get("tiers", [])
    for tier in output_tiers:
        if output_tokens <= tier["up_to"]:
            total_cost += (tier["price"] / 1_000_000) * output_tokens
            break
    return total_cost

def get_project_context(is_fast_mode, files_to_include_fully=None):
    print(f"{Colors.CYAN}{Symbols.SPINNER} –õ–û–ì: –û–±–Ω–æ–≤–ª—è—é –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞...{Colors.ENDC}")
    try:
        if is_fast_mode:
            context_data = context_collector.gather_project_context(os.getcwd(), mode='full')
        else:
            mode = 'summarized'
            if files_to_include_fully:
                print(f"{Colors.GREY}{Symbols.INFO}  –ü–æ–ª–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–æ–≤: {len(files_to_include_fully)} —à—Ç.{Colors.ENDC}")
            context_data = context_collector.gather_project_context(
                os.getcwd(), mode=mode, full_content_files=files_to_include_fully
            )
        print(f"{Colors.OKGREEN}{Symbols.CHECK} –õ–û–ì: –ö–æ–Ω—Ç–µ–∫—Å—Ç —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω. –†–∞–∑–º–µ—Ä: {len(context_data)} —Å–∏–º–≤–æ–ª–æ–≤.{Colors.ENDC}")
        return context_data
    except Exception as e:
        print(f"{Colors.BOLD}{Colors.FAIL}{Symbols.CROSS} –õ–û–ì: –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –≤ get_project_context: {e}{Colors.ENDC}")
        return None

def _log_run(log_file_path, title, content):
    try:
        with open(log_file_path, 'a', encoding='utf-8') as f:
            f.write("\n" + "="*80 + "\n" + f"{title}\n" + "-"*80 + "\n")
            f.write(str(content if content is not None else "<empty>") + "\n")
    except Exception as e:
        print(f"{Colors.WARNING}{Symbols.WARNING}  –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –≤ {log_file_path}: {e}{Colors.ENDC}")

def _read_multiline_input(prompt):
    print(prompt)
    lines = []
    empty_line_count = 0
    while empty_line_count < 3:
        try:
            line = input()
            if line:
                lines.append(line)
                empty_line_count = 0
            else:
                empty_line_count += 1
        except EOFError:
            break
    return '\n'.join(lines).strip()

def get_user_input():
    goal_prompt = (f"{Colors.HEADER}{Colors.BOLD} –ü—Ä–∏–≤–µ—Ç! –û–ø–∏—à–∏ —Å–≤–æ—é –æ—Å–Ω–æ–≤–Ω—É—é —Ü–µ–ª—å.{Colors.ENDC}\n"
                   f"{Colors.CYAN}{Symbols.INFO} (–î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–≤–æ–¥–∞, –Ω–∞–∂–º–∏ Enter 3 —Ä–∞–∑–∞ –ø–æ–¥—Ä—è–¥){Colors.ENDC}")
    user_goal = _read_multiline_input(goal_prompt)
    if not user_goal:
        return None, None
    log_prompt = (f"\n{Colors.HEADER}{Colors.BOLD} –û—Ç–ª–∏—á–Ω–æ. –¢–µ–ø–µ—Ä—å, –µ—Å–ª–∏ –µ—Å—Ç—å –ª–æ–≥ –æ—à–∏–±–∫–∏, –≤—Å—Ç–∞–≤—å –µ–≥–æ. –ï—Å–ª–∏ –Ω–µ—Ç, –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–∏ Enter 3 —Ä–∞–∑–∞.{Colors.ENDC}")
    error_log = _read_multiline_input(log_prompt)
    return user_goal, error_log

def extract_block(tag, text):
    """–ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø–µ—Ä–≤—ã–π –±–ª–æ–∫ –≤–∏–¥–∞ ```{tag}\n...\n```."""
    lines = text.splitlines()
    start_idx = None
    fence_prefix = f"```{tag}"
    for i, line in enumerate(lines):
        if line.strip().startswith(fence_prefix):
            start_idx = i + 1
            break
    if start_idx is None:
        return None
    for j in range(start_idx, len(lines)):
        if lines[j].strip() == "```":
            content = "\n".join(lines[start_idx:j])
            return content.strip()
    return None

_ALLOWED_TAGS_AFTER_FENCE = {"summary","bash","manual","files","plan","clarification","done_summary","write_file"}

def _parse_write_file_header(header_line: str):
    header = header_line.strip()
    if header.startswith("```write_file"):
        header = header[len("```write_file"):].strip()
    path, boundary = "", None
    m = re.search(r'boundary\s*=\s*"([^"]+)"', header) or re.search(r'boundary\s*=\s*([^\s]+)', header)
    if m: boundary = m.group(1).strip().strip('"').strip("'")
    p = re.search(r'path\s*=\s*"([^"]+)"', header) or re.search(r'path\s*=\s*([^\s]+)', header)
    if p: path = p.group(1).strip().strip('"').strip("'")
    else:
        for tok in header.split():
            if "=" not in tok:
                path = tok.strip().strip('"').strip("'"); break
    return path, boundary

def _iter_write_file_blocks(answer_text: str, boundary_token: str):
    lines, i, n = answer_text.splitlines(), 0, len(answer_text.splitlines())
    while i < n:
        ln = lines[i].strip()
        if ln.startswith("```write_file"):
            filepath, boundary = _parse_write_file_header(ln)
            i += 1
            content = []
            if boundary:  # –≥–ª–∞–≤–Ω—ã–π –ø—É—Ç—å: —á–∏—Ç–∞–µ–º –¥–æ —Å—Ç—Ä–æ–∫–∏-–≥—Ä–∞–Ω–∏—Ü—ã
                while i < n and lines[i].strip() != boundary:
                    content.append(lines[i]); i += 1
                if i < n and lines[i].strip() == boundary: i += 1
                if i < n and lines[i].strip() == "```": i += 1
                yield filepath, "\n".join(content); continue
            # fallback: –∑–∞–∫—Ä—ã—Ç–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ—Å–ª–µ ``` —Ä–µ–∞–ª—å–Ω–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –±–ª–æ–∫
            while i < n:
                if lines[i].strip() == "```":
                    j = i + 1
                    while j < n and lines[j].strip() == "": j += 1
                    if j >= n: break
                    nxt = lines[j].strip()
                    if nxt.startswith("```"): break
                    if any(nxt.startswith(t) or nxt.startswith(f"```{t}") for t in _ALLOWED_TAGS_AFTER_FENCE):
                        break
                    content.append(lines[i]); i += 1; continue
                content.append(lines[i]); i += 1
            if i < n and lines[i].strip() == "```": i += 1
            yield filepath, "\n".join(content); continue
        i += 1

def _normalize_model_path(p: str) -> str:
    p = (p or "").strip().strip('"').strip("'").replace("\\","/")
    if p.startswith("./"): p = p[2:]
    cwd = os.getcwd(); root = os.path.basename(cwd.rstrip(os.sep))
    cwd_posix = cwd.replace("\\","/").rstrip("/")
    if p.startswith("/"):
        if p.startswith(cwd_posix + "/"): p = p[len(cwd_posix)+1:]
        else: p = p.lstrip("/")
    if p.startswith(root + "/"): p = p[len(root)+1:]
    p = os.path.normpath(p).replace("\\","/")
    if p.startswith("../"): p = p[3:]
    if p == ".": p = ""
    return p

def update_history_with_attempt(history_file_path, goal, summary):
    try:
        with open(history_file_path, 'r+', encoding='utf-8') as f:
            history_data = json.load(f)
            new_entry = {"initial_goal": goal, "solution_summary": summary}
            history_data.setdefault("previous_attempts", []).insert(0, new_entry)
            f.seek(0)
            json.dump(history_data, f, indent=2, ensure_ascii=False)
            f.truncate()
        print(f"{Colors.OKGREEN}üíæ –õ–û–ì: –ò—Å—Ç–æ—Ä–∏—è —Ä–µ—à–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –≤ {history_file_path}.{Colors.ENDC}")
    except Exception as e:
        print(f"{Colors.FAIL}‚ùå –õ–û–ì: –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ä–µ—à–µ–Ω–∏—è: {e}{Colors.ENDC}")

def load_fix_history(history_file_path):
    if not os.path.exists(history_file_path):
        return None
    try:
        with open(history_file_path, 'r', encoding='utf-8') as f:
            history_data = json.load(f)
        attempts = history_data.get("previous_attempts", [])
        if not attempts:
            return None
        last_attempt = attempts[0]
        return (f"–≠—Ç–æ —Ç–≤–æ—è —Å–∞–º–∞—è –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ —Ä–µ—à–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è –æ–∫–∞–∑–∞–ª–∞—Å—å –Ω–µ–≤–µ—Ä–Ω–æ–π:\n"
                f"  - –ü–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞: {last_attempt.get('initial_goal', 'N/A')}\n"
                f"  - –¢–≤–æ–µ '—Ä–µ—à–µ–Ω–∏–µ': {last_attempt.get('solution_summary', 'N/A')}")
    except Exception as e:
        print(f"{Colors.FAIL}‚ùå –õ–û–ì: –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–ª–∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª –∏—Å—Ç–æ—Ä–∏–∏ {history_file_path}: {e}{Colors.ENDC}")
        return None

def notify_user(message):
    clean_message = re.sub(r'\033\[.*?m', '', message)
    print(f"{Colors.OKBLUE}üì¢ –õ–û–ì: –û—Ç–ø—Ä–∞–≤–ª—è—é –∏—Ç–æ–≥–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ...{Colors.ENDC}")
    print(message)

def cost_report(cost_log, total_cost):
    print(f"\n{Colors.BOLD}{Colors.HEADER}--- –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢ –ü–û –°–¢–û–ò–ú–û–°–¢–ò ---{Colors.ENDC}")
    for entry in cost_log:
        phase, cost = entry['phase'], entry['cost']
        if phase == 'PLANNING':
            print(f"  –§–∞–∑–∞: {phase:<12} | –°—Ç–æ–∏–º–æ—Å—Ç—å: ${cost:.6f}")
        else:
            iteration = entry['iteration']
            print(f"  –§–∞–∑–∞: {phase:<12} | –ò—Ç–µ—Ä–∞—Ü–∏—è: {iteration:<2} | –°—Ç–æ–∏–º–æ—Å—Ç—å: ${cost:.6f}")
    print(f"{Colors.BOLD}\n  –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–¥–∞—á–∏: ${total_cost:.6f}{Colors.ENDC}")

def main(is_fix_mode, is_fast_mode, history_file_path, run_log_file_path):
    # –ú–æ–¥–µ–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤ —Ç–æ—á–∫–µ –≤—Ö–æ–¥–∞ –¥–æ –≤—ã–∑–æ–≤–∞ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
    model_instance, active_service = sloth_core.get_active_service_details()
    if not model_instance:
        # –≠—Ç–æ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ - –º–µ—Ä–∞ –ø—Ä–µ–¥–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏, –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ —É–∂–µ –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ —ç—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å.
        return f"{Colors.FAIL}–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ–± –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏. –í—ã—Ö–æ–¥.{Colors.ENDC}"

    total_cost, cost_log = 0.0, []
    user_goal, error_log = get_user_input()
    if not user_goal:
        return f"{Colors.WARNING}–¶–µ–ª—å –Ω–µ –±—ã–ª–∞ —É–∫–∞–∑–∞–Ω–∞. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã.{Colors.ENDC}"
    initial_task = user_goal + (f"\n\n--- –õ–û–ì –û–®–ò–ë–ö–ò ---\n{error_log}" if error_log else "")
    
    attempt_history, final_message = [], ""
    state = "EXECUTION" if is_fast_mode else "PLANNING"
    iteration_count, files_to_include_fully, current_prompt = 1, None, None

    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω-–≥—Ä–∞–Ω–∏—Ü—É –¥–ª—è write_file
    BOUNDARY_TOKEN = f"SLOTH_BOUNDARY_{uuid.uuid4().hex}"

    while iteration_count <= MAX_ITERATIONS:
        model_instance, active_service = sloth_core.get_active_service_details()

        if state == "PLANNING":
            print(f"\n{Colors.BOLD}{Colors.HEADER}--- –≠–¢–ê–ü: –ü–õ–ê–ù–ò–†–û–í–ê–ù–ò–ï ---{Colors.ENDC}")
            project_context = get_project_context(is_fast_mode=False, files_to_include_fully=None)
            if not project_context:
                return f"{Colors.FAIL}–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞.{Colors.ENDC}"
            current_prompt = sloth_core.get_clarification_and_planning_prompt(project_context, initial_task, boundary=BOUNDARY_TOKEN)
        
        elif state == "EXECUTION" and current_prompt is None:
            project_context = get_project_context(is_fast_mode, files_to_include_fully)
            if not project_context:
                return f"{Colors.FAIL}–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç.{Colors.ENDC}"
            current_prompt = sloth_core.get_initial_prompt(
                project_context, initial_task,
                sloth_core.get_active_service_details() and (load_fix_history(history_file_path) if is_fix_mode else None),
                boundary=BOUNDARY_TOKEN
            )
            
        log_iter = iteration_count if state == "EXECUTION" else 0
        if state == "EXECUTION":
            print(f"\n{Colors.BOLD}{Colors.HEADER}{Symbols.ROCKET} --- –≠–¢–ê–ü: –ò–°–ü–û–õ–ù–ï–ù–ò–ï | –ò–¢–ï–†–ê–¶–ò–Ø {iteration_count}/{MAX_ITERATIONS} ---{Colors.ENDC}")
        
        _log_run(run_log_file_path, f"–ó–ê–ü–†–û–° (–°–æ—Å—Ç–æ—è–Ω–∏–µ: {state}, –ò—Ç–µ—Ä–∞—Ü–∏—è: {log_iter})", current_prompt)
        answer_data = sloth_core.send_request_to_model(model_instance, active_service, current_prompt, log_iter)
        
        if not answer_data:
            if sloth_core.model:
                print(f"{Colors.WARNING}üîÑ –õ–û–ì: –û—Ç–≤–µ—Ç –æ—Ç –º–æ–¥–µ–ª–∏ –Ω–µ –ø–æ–ª—É—á–µ–Ω, –ø—Ä–æ–±—É—é —Å–Ω–æ–≤–∞...{Colors.ENDC}")
                time.sleep(5)
                continue
            else:
                final_message = "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –∏ –Ω–µ—Ç –∑–∞–ø–∞—Å–Ω–æ–≥–æ API."
                break

        answer_text = answer_data["text"]
        _log_run(run_log_file_path, f"–û–¢–í–ï–¢ (–°–æ—Å—Ç–æ—è–Ω–∏–µ: {state}, –ò—Ç–µ—Ä–∞—Ü–∏—è: {log_iter})", answer_text)

        cost = calculate_cost(sloth_core.MODEL_NAME, answer_data["input_tokens"], answer_data["output_tokens"])
        total_cost += cost
        cost_log.append({"phase": state, "iteration": log_iter, "cost": cost})
        print(f"{Colors.GREY}üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –í—Ö–æ–¥: {answer_data['input_tokens']} —Ç., –í—ã—Ö–æ–¥: {answer_data['output_tokens']} —Ç. –°—Ç–æ–∏–º–æ—Å—Ç—å: ~${cost:.6f}{Colors.ENDC}")

        if state == "PLANNING":
            clarification = extract_block("clarification", answer_text)
            if clarification:
                print(f"{Colors.HEADER}{Colors.BOLD}ü§ñ –ú–æ–¥–µ–ª—å –ø—Ä–æ—Å–∏—Ç —É—Ç–æ—á–Ω–µ–Ω–∏–π:{Colors.ENDC}\n{Colors.CYAN}{clarification}{Colors.ENDC}")
                user_response = _read_multiline_input("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –º–æ–¥–µ–ª–∏. (Enter 3 —Ä–∞–∑–∞ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è)")
                initial_task += f"\n\n--- –£–¢–û–ß–ù–ï–ù–ò–ï –û–¢ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ---\n{user_response}"
                current_prompt = None
                continue

            plan = extract_block("plan", answer_text)
            files_list_str = extract_block("files", answer_text)
            if plan and files_list_str:
                print(f"{Colors.OKGREEN}‚úÖ –ó–∞–¥–∞—á–∞ –ø–æ–Ω—è—Ç–Ω–∞. –ü–ª–∞–Ω –ø–æ–ª—É—á–µ–Ω.{Colors.ENDC}\n{Colors.HEADER}–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:{Colors.ENDC}\n{Colors.CYAN}{plan}{Colors.ENDC}")
                with open("sloth_plan.txt", "w", encoding='utf-8') as f:
                    f.write(plan)
                print(f"{Colors.OKGREEN}–ü–ª–∞–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ 'sloth_plan.txt'.{Colors.ENDC}")
                raw_files_list = [line.strip() for line in files_list_str.split('\n') if line.strip()]
                project_root_name = os.path.basename(os.getcwd()) + os.sep
                files_to_include_fully = []
                for f_path in raw_files_list:
                    if f_path.startswith(project_root_name):
                        normalized_path = f_path[len(project_root_name):]
                        files_to_include_fully.append(normalized_path)
                        print(f"{Colors.GREY}‚ÑπÔ∏è  –ü—É—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω: '{f_path}' -> '{normalized_path}'{Colors.ENDC}")
                    else:
                        files_to_include_fully.append(f_path)
                print(f"{Colors.HEADER}–ó–∞–ø—Ä–æ—à–µ–Ω—ã –ø–æ–ª–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —Ñ–∞–π–ª–æ–≤:{Colors.ENDC}\n{Colors.CYAN}" + "\n".join(files_to_include_fully) + Colors.ENDC)
                state = "EXECUTION"
                current_prompt = None
                continue
            else:
                print(f"{Colors.WARNING}‚ö†Ô∏è –ú–æ–¥–µ–ª—å –Ω–µ –≤–µ—Ä–Ω—É–ª–∞ –Ω–∏ —É—Ç–æ—á–Ω–µ–Ω–∏–π, –Ω–∏ –ø–ª–∞–Ω–∞. –ü—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞...{Colors.ENDC}")
                time.sleep(5)
                continue

        elif state == "EXECUTION":
            if extract_block("done_summary", answer_text) or answer_text.strip().upper().startswith("–ì–û–¢–û–í–û"):
                done_summary = extract_block("done_summary", answer_text) or "–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞."
                final_message = f"{Colors.OKGREEN}{Symbols.CHECK} –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ! (–∑–∞ {iteration_count} –∏—Ç–µ—Ä–∞—Ü–∏–π){Colors.ENDC}"
                update_history_with_attempt(history_file_path, user_goal, done_summary)
                print(f"{Colors.OKGREEN}üìÑ –ò–¢–û–ì–û–í–û–ï –†–ï–ó–Æ–ú–ï:\n{Colors.CYAN}{done_summary}{Colors.ENDC}")
                manual_steps = extract_block("manual", answer_text)
                if manual_steps:
                    final_message += f"\n\n{Colors.WARNING}‚úã –¢–†–ï–ë–£–Æ–¢–°–Ø –†–£–ß–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø:{Colors.ENDC}\n{manual_steps}"
                break
            
            # --- –û–ë–†–ê–ë–û–¢–ö–ê –î–ï–ô–°–¢–í–ò–ô: write_file (–º—É–ª—å—Ç–∏-–±–ª–æ–∫–∏) –∏–ª–∏ bash ---
            commands_to_run = extract_block("bash", answer_text)
            write_blocks = list(_iter_write_file_blocks(answer_text, boundary_token=BOUNDARY_TOKEN))
            strategy_description = extract_block("summary", answer_text) or "–°—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–µ –æ–ø–∏—Å–∞–Ω–∞"
            
            action_taken, success, failed_command, error_message = False, False, "N/A", ""

            if write_blocks:
                action_taken = True
                for raw_filepath, content in write_blocks:
                    try:
                        filepath = _normalize_model_path(raw_filepath)
                        print(f"\n{Colors.OKBLUE}üìù –ù–∞–π–¥–µ–Ω –±–ª–æ–∫ write_file. –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é —Ñ–∞–π–ª: {filepath}{Colors.ENDC}")
                        dir_name = os.path.dirname(filepath)
                        if dir_name:
                            os.makedirs(dir_name, exist_ok=True)
                        # –ü–∏—à–µ–º –ë–ï–ó strip(), –° –†–û–í–ù–û –¢–ï–ú –°–û–î–ï–†–ñ–ò–ú–´–ú, –ß–¢–û –ü–†–ò–®–õ–û
                        # –ñ—ë—Å—Ç–∫–∏–π —Å—ç–Ω–¥–±–æ–∫—Å: –∑–∞–ø–∏—Å—å —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
                        abs_path = os.path.realpath(filepath)
                        root_abs = os.path.realpath(os.getcwd())
                        if not abs_path.startswith(root_abs + os.sep):
                            raise RuntimeError(f"–ó–∞–ø—Ä–µ—â—ë–Ω –ø—É—Ç—å –≤–Ω–µ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞: {filepath}")
                        with open(filepath, "w", encoding="utf-8", newline="") as f:
                            f.write(content)
                        print(f"{Colors.OKGREEN}‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω: {filepath}{Colors.ENDC}")
                        success = True
                    except Exception as e:
                        print(f"{Colors.FAIL}‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–∞ '{raw_filepath}': {e}{Colors.ENDC}")
                        success = False
                        failed_command = f"write_file {raw_filepath}"
                        error_message = str(e)
                        break  # –ø—Ä–µ–∫—Ä–∞—â–∞–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

            elif commands_to_run:
                action_taken = True
                print(f"\n{Colors.OKBLUE}üîß –ù–∞–π–¥–µ–Ω –±–ª–æ–∫ shell-–∫–æ–º–∞–Ω–¥. –í—ã–ø–æ–ª–Ω—è—é...{Colors.ENDC}")
                success, failed_command, error_message = sloth_runner.execute_commands(commands_to_run)

            if not action_taken:
                print(f"{Colors.FAIL}‚ùå –õ–û–ì: –ú–æ–¥–µ–ª—å –Ω–µ –≤–µ—Ä–Ω—É–ª–∞ –∫–æ–º–∞–Ω–¥. –ü—Ä–æ–±—É—é –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏.{Colors.ENDC}")
                project_context = get_project_context(is_fast_mode, files_to_include_fully)
                current_prompt = sloth_core.get_review_prompt(project_context, user_goal, iteration_count + 1, attempt_history, boundary=BOUNDARY_TOKEN)
                iteration_count += 1
                continue
            
            project_context = get_project_context(is_fast_mode, files_to_include_fully)
            if not project_context:
                final_message = f"{Colors.FAIL}–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç.{Colors.ENDC}"
                break

            history_entry = f"**–ò—Ç–µ—Ä–∞—Ü–∏—è {iteration_count}:**\n**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:** {strategy_description}\n"
            if success:
                history_entry += "**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£–°–ü–ï–•"
                current_prompt = sloth_core.get_review_prompt(project_context, user_goal, iteration_count + 1, attempt_history, boundary=BOUNDARY_TOKEN)
            else:
                history_entry += f"**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–†–û–í–ê–õ\n**–û—à–∏–±–∫–∞:** {error_message}"
                current_prompt = sloth_core.get_error_fixing_prompt(
                    failed_command, error_message, user_goal, project_context, iteration_count + 1, attempt_history, boundary=BOUNDARY_TOKEN
                )
            
            attempt_history.append(history_entry)
            iteration_count += 1
    
    if not final_message:
        final_message = f"{Colors.WARNING}‚åõ –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –≤ {MAX_ITERATIONS} –∏—Ç–µ—Ä–∞—Ü–∏–π.{Colors.ENDC}"
    cost_report(cost_log, total_cost)
    return final_message

# --- –¢–û–ß–ö–ê –í–•–û–î–ê ---
if __name__ == "__main__":
    SLOTH_SCRIPT_DIR = os.path.dirname(os.path.abspath(__file__))
    parser = argparse.ArgumentParser(description="Sloth: AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –∫–æ–¥–∞.")
    parser.add_argument('--here', action='store_true', help='–ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è —Å --fix).')
    parser.add_argument('--fix', action='store_true', help='–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ä–µ–∂–∏–º–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –∑–∞–≥—Ä—É–∑–∏–≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–µ—Å—Å–∏–∏.')
    parser.add_argument('--fast', action='store_true', help='–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ –±—ã—Å—Ç—Ä–æ–º —Ä–µ–∂–∏–º–µ (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è —Å --fix).')
    args = parser.parse_args()

    # --- 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ ---
    sloth_core.initialize_model()
    model_instance, _ = sloth_core.get_active_service_details()
    if not model_instance:
        print(f"{Colors.FAIL}‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å. "
              f"–ü—Ä–æ–≤–µ—Ä—å—Ç–µ API-–∫–ª—é—á –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã.{Colors.ENDC}")
        sys.exit(1)
    print(f"{Colors.OKGREEN}‚úÖ –ú–æ–¥–µ–ª—å AI —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞.{Colors.ENDC}\n")

    # --- 2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—É—Ç–∏ –∫ –ø—Ä–æ–µ–∫—Ç—É ---
    history_file_path = os.path.join(SLOTH_SCRIPT_DIR, HISTORY_FILE_NAME)
    target_project_path, is_fast_mode = "", args.fast

    if args.fix:
        print(f"{Colors.CYAN}{Symbols.GEAR}  –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω —Ä–µ–∂–∏–º --fix. –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ {history_file_path}...{Colors.ENDC}")
        if not os.path.exists(history_file_path):
            print(f"{Colors.BOLD}{Colors.FAIL}{Symbols.CROSS} –û–®–ò–ë–ö–ê: –§–∞–π–ª –∏—Å—Ç–æ—Ä–∏–∏ {history_file_path} –Ω–µ –Ω–∞–π–¥–µ–Ω.{Colors.ENDC}")
            sys.exit(1)
        try:
            with open(history_file_path, 'r', encoding='utf-8') as f:
                config = json.load(f).get("last_run_config")
            target_project_path, is_fast_mode = config["target_project_path"], config["is_fast_mode"]
            print(f"{Colors.OKGREEN}{Symbols.CHECK} –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ü—Ä–æ–µ–∫—Ç: {target_project_path}, –†–µ–∂–∏–º: {'–ë—ã—Å—Ç—Ä—ã–π' if is_fast_mode else '–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π'}.{Colors.ENDC}")
        except Exception as e:
            print(f"{Colors.BOLD}{Colors.FAIL}{Symbols.CROSS} –û–®–ò–ë–ö–ê: –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: {e}{Colors.ENDC}")
            sys.exit(1)
    else:
        if args.here:
            target_project_path = os.getcwd()
        else:
            print(f"{Colors.OKBLUE}–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞ –≤ –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è –æ–∫–Ω–µ...{Colors.ENDC}")
            root = Tk(); root.withdraw()
            target_project_path = filedialog.askdirectory(title="–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è Sloth")
            root.destroy()
        if not target_project_path:
            print(f"{Colors.BOLD}{Colors.FAIL}{Symbols.CROSS} –ü–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ –±—ã–ª–∞ –≤—ã–±—Ä–∞–Ω–∞.{Colors.ENDC}")
            sys.exit(1)
        if os.path.exists(history_file_path):
            os.remove(history_file_path)
        initial_history = {
            "last_run_config": {"target_project_path": target_project_path, "is_fast_mode": is_fast_mode},
            "previous_attempts": []
        }
        with open(history_file_path, 'w', encoding='utf-8') as f:
            json.dump(initial_history, f, indent=2, ensure_ascii=False)
        print(f"{Colors.CYAN}{Symbols.SAVE} –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ {history_file_path}.{Colors.ENDC}")

    # --- 3. –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏ –∑–∞–ø—É—Å–∫ ---
    print(f"{Colors.OKGREEN}{Symbols.CHECK} –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞: {target_project_path}{Colors.ENDC}")
    os.chdir(target_project_path)
    run_log_file_path = os.path.join(SLOTH_SCRIPT_DIR, RUN_LOG_FILE_NAME)
    try:
        with open(run_log_file_path, 'w', encoding='utf-8') as f:
            f.write(f"# SLOTH RUN LOG\n# –¶–µ–ª–µ–≤–æ–π –ø—Ä–æ–µ–∫—Ç: {target_project_path}\n# –†–µ–∂–∏–º: {'–ë—ã—Å—Ç—Ä—ã–π' if is_fast_mode else '–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π'}\n")
    except Exception as e:
        print(f"{Colors.WARNING}{Symbols.WARNING}  –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å {run_log_file_path}: {e}{Colors.ENDC}")
    
    final_status = "–†–∞–±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞."
    try:
        final_status = main(is_fix_mode=args.fix, is_fast_mode=is_fast_mode, history_file_path=history_file_path, run_log_file_path=run_log_file_path)
    except KeyboardInterrupt:
        final_status = f"\n{Colors.OKBLUE}{Symbols.BLUE_DOT} –ü—Ä–æ—Ü–µ—Å—Å –ø—Ä–µ—Ä–≤–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.{Colors.ENDC}"
    except Exception as e:
        import traceback; traceback.print_exc()
        final_status = f"\n{Colors.BOLD}{Colors.FAIL}{Symbols.CROSS} –°–∫—Ä–∏–ø—Ç –∞–≤–∞—Ä–∏–π–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è: {e}{Colors.ENDC}"
    finally:
        print(f"\n{final_status}")
        print(f"\n{Colors.BOLD}{Symbols.FLAG} –°–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É.{Colors.ENDC}")


–§–∞–π–ª: sloth_core.py
-------------------
# –§–∞–π–ª: sloth_core.py
"""
–Ø–¥—Ä–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Gemini (Google AI / Vertex AI) –¥–ª—è Sloth.

–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å —Ç–≤–æ–µ–π –≤–µ—Ä—Å–∏–µ–π:
- –ë–û–õ–¨–®–ï –ù–ï –ó–ê–î–ê–Å–¢–°–Ø max_output_tokens ‚Üí –æ—Ç–¥–∞—ë–º –º–æ–¥–µ–ª–∏ –ø—Ä–∞–≤–æ –ø–∏—Å–∞—Ç—å –º–∞–∫—Å–∏–º—É–º.
- –î–æ–±–∞–≤–ª–µ–Ω thinking budget (–±—é–¥–∂–µ—Ç –Ω–∞ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è), –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω:
  * –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –Ω–æ–≤–æ–≥–æ SDK google-genai: —á–µ—Ä–µ–∑ GenerateContentConfig(thinking_config=ThinkingConfig(...))
  * –í Vertex AI: —á–µ—Ä–µ–∑ GenerationConfig(thinking_config=ThinkingConfig(...))
  * –í —Å—Ç–∞—Ä–æ–º google.generativeai thinking –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî –ø–µ—á–∞—Ç–∞—é –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç–µ–ª—å–Ω—ã–π –ª–æ–≥.
- –û—Ç–≤–µ—Ç —Å–æ–±–∏—Ä–∞—é –Ω–∞–¥—ë–∂–Ω–æ (response.text, –ª–∏–±–æ parts), usage —Å—á–∏—Ç—ã–≤–∞—é –±–µ—Ä–µ–∂–Ω–æ —Å –∑–∞–ø–∞—Å–Ω—ã–º–∏ –≤–µ—Ç–∫–∞–º–∏.

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:
- –ó–Ω–∞—á–µ–Ω–∏–µ –±—é–¥–∂–µ—Ça —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∑—è–ª 24576 —Ç–æ–∫–µ–Ω–æ–≤, —Ç.–∫. —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤—ã—Å–æ–∫–∏–π –ø—Ä–µ–¥–µ–ª,
  —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å 2.5-—Å–µ—Ä–∏–µ–π –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π. –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å env SLOTH_THINKING_BUDGET.
"""

import os
from colors import Colors

# --- –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π Google GenAI SDK (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ) ---
HAS_GOOGLE_GENAI = False
try:
    from google import genai as genai_new
    from google.genai.types import GenerateContentConfig, ThinkingConfig
    HAS_GOOGLE_GENAI = True
except Exception:
    genai_new = None
    GenerateContentConfig = None
    ThinkingConfig = None
    HAS_GOOGLE_GENAI = False

# --- –°—Ç–∞—Ä—ã–π SDK (fallback, –±–µ–∑ thinking budget) ---
HAS_LEGACY_GENAI = False
try:
    import google.generativeai as genai_legacy
    HAS_LEGACY_GENAI = True
except Exception:
    genai_legacy = None
    HAS_LEGACY_GENAI = False

# --- Vertex AI SDK ---
import vertexai
from vertexai.generative_models import GenerativeModel, HarmCategory, HarmBlockThreshold
# –≠—Ç–∏ –∏–º–ø–æ—Ä—Ç—ã –º–æ–≥—É—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏—è—Ö –ø–∞–∫–µ—Ç–∞; –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –º—è–≥–∫–æ
try:
    from vertexai.generative_models import GenerationConfig as VertexGenerationConfig  # —Ç–∏–ø –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
except Exception:
    VertexGenerationConfig = None
try:
    from vertexai.generative_models import ThinkingConfig as VertexThinkingConfig     # thinking –∫–æ–Ω—Ñ–∏–≥
except Exception:
    VertexThinkingConfig = None

# --- –ù–ê–°–¢–†–û–ô–ö–ò –Ø–î–†–ê ---
GOOGLE_API_KEY = os.getenv("GOOGLE_API_KEY", "REDACTED_GOOGLE_API_KEY")
GOOGLE_CLOUD_PROJECT = os.getenv("GOOGLE_CLOUD_PROJECT", "useful-gearbox-464618-v3")
GOOGLE_CLOUD_LOCATION = os.getenv("GOOGLE_CLOUD_LOCATION", "us-central1")
MODEL_NAME = os.getenv("SLOTH_MODEL_NAME", "gemini-2.5-pro")
API_TIMEOUT_SECONDS = int(os.getenv("SLOTH_API_TIMEOUT", "600"))

# –í–ê–ñ–ù–û: –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±—é–¥–∂–µ—Ç —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π. –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —á–µ—Ä–µ–∑ env SLOTH_THINKING_BUDGET
THINKING_BUDGET_TOKENS = int(os.getenv("SLOTH_THINKING_BUDGET", "24576"))

# –ö–æ–º–∞–Ω–¥—ã-–∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è bash
ALLOWED_COMMANDS = (
    "rm", "mv", "touch", "mkdir", "npm", "npx", "yarn", "pnpm", "git", "echo", "./"
)

MODEL_PRICING = {
    "gemini-2.5-pro": {
        "input": {"tiers": [{"up_to": 200000, "price": 1.25}, {"up_to": float('inf'), "price": 2.50}]},
        "output": {"tiers": [{"up_to": 200000, "price": 10.00}, {"up_to": float('inf'), "price": 15.00}]}
    },
    "gemini-1.5-pro-latest": {
        "input": {"tiers": [{"up_to": float('inf'), "price": 3.50}]},
        "output": {"tiers": [{"up_to": float('inf'), "price": 10.50}]}
    }
}

# --- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è API ---
model = None  # –≤ —Ä–µ–∂–∏–º–µ google-genai –∑–¥–µ—Å—å –±—É–¥–µ—Ç client, –≤ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö ‚Äî –æ–±—ä–µ–∫—Ç –º–æ–¥–µ–ª–∏
ACTIVE_API_SERVICE = "N/A"
GOOGLE_AI_HAS_FAILED_THIS_SESSION = False

# –ë–∞–∑–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚Äî –ë–ï–ó max_output_tokens!
GENERATION_TEMPERATURE = float(os.getenv("SLOTH_TEMPERATURE", "1"))
GENERATION_TOP_P = float(os.getenv("SLOTH_TOP_P", "1"))
GENERATION_TOP_K = int(float(os.getenv("SLOTH_TOP_K", "1")))

def _log_generation_params():
    print(
        f"{Colors.CYAN}üîß –õ–û–ì: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:"
        f" temperature={GENERATION_TEMPERATURE}, top_p={GENERATION_TOP_P}, top_k={GENERATION_TOP_K}."
        f" max_output_tokens –ù–ï –∑–∞–¥–∞–Ω –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ.{Colors.ENDC}"
    )
    print(
        f"{Colors.CYAN}üß© –õ–û–ì: –ë—é–¥–∂–µ—Ç —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π (thinking_budget) = {THINKING_BUDGET_TOKENS} —Ç–æ–∫–µ–Ω–æ–≤, –µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è SDK/–º–æ–¥–µ–ª—å.{Colors.ENDC}"
    )

def initialize_model():
    """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–æ–¥–µ–ª—å –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–π —Å–µ—Ä–≤–∏—Å —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º:
    1) Google GenAI SDK (api key) ‚Üí thinking_config –¥–æ—Å—Ç—É–ø–µ–Ω
    2) –°—Ç–∞—Ä—ã–π google.generativeai (api key) ‚Üí thinking_config –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
    3) Vertex AI SDK (ADC/Service Account) ‚Üí thinking_config –¥–æ—Å—Ç—É–ø–µ–Ω
    """
    global model, ACTIVE_API_SERVICE, GOOGLE_AI_HAS_FAILED_THIS_SESSION

    print(f"{Colors.CYAN}‚öôÔ∏è  –õ–û–ì: –ù–∞—á–∏–Ω–∞—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é. –ú–æ–¥–µ–ª—å: {MODEL_NAME}{Colors.ENDC}")
    _log_generation_params()

    # --- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –Ω–æ–≤—ã–π Google GenAI SDK (api key) ---
    if GOOGLE_API_KEY and HAS_GOOGLE_GENAI and not GOOGLE_AI_HAS_FAILED_THIS_SESSION:
        print(f"{Colors.CYAN}üîë –õ–û–ì: –ü—Ä–æ–±—É—é Google GenAI SDK (–ø–æ API-–∫–ª—é—á—É).{Colors.ENDC}")
        try:
            model = genai_new.Client(api_key=GOOGLE_API_KEY)
            # –¢–µ—Å—Ç–æ–≤—ã–π –∫–æ—Ä–æ—Ç–∫–∏–π –≤—ã–∑–æ–≤ (–Ω–µ –∑–∞–¥–∞—ë–º max_output_tokens)
            _ = model.models.generate_content(
                model=MODEL_NAME,
                contents="ping"
            )
            ACTIVE_API_SERVICE = "Google GenAI SDK"
            print(f"{Colors.OKGREEN}‚úÖ –õ–û–ì: –£—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ {ACTIVE_API_SERVICE}.{Colors.ENDC}")
            return
        except Exception as e:
            print(f"{Colors.WARNING}‚ö†Ô∏è  –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –°–±–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ GenAI SDK: {e}{Colors.ENDC}")
            GOOGLE_AI_HAS_FAILED_THIS_SESSION = True
            model = None

    # --- Fallback: —Å—Ç–∞—Ä—ã–π google.generativeai (api key) ---
    if GOOGLE_API_KEY and HAS_LEGACY_GENAI and not model:
        print(f"{Colors.CYAN}üîë –õ–û–ì: –ü—Ä–æ–±—É—é —Å—Ç–∞—Ä—ã–π google.generativeai (API Key).{Colors.ENDC}")
        try:
            genai_legacy.configure(api_key=GOOGLE_API_KEY)
            # –í–ê–ñ–ù–û: generation_config –±–µ–∑ max_output_tokens
            generation_config = {
                "temperature": GENERATION_TEMPERATURE,
                "top_p": GENERATION_TOP_P,
                "top_k": GENERATION_TOP_K,
            }
            model = genai_legacy.GenerativeModel(
                model_name=MODEL_NAME,
                generation_config=generation_config,
                safety_settings={
                    'HARM_CATEGORY_HARASSMENT': 'block_medium_and_above',
                    'HARM_CATEGORY_HATE_SPEECH': 'block_medium_and_above',
                    'HARM_CATEGORY_SEXUALLY_EXPLICIT': 'block_medium_and_above',
                    'HARM_CATEGORY_DANGEROUS_CONTENT': 'block_none',
                }
            )
            # –ü—Ä–æ–±–Ω—ã–π –≤—ã–∑–æ–≤
            model.generate_content("test", request_options={"timeout": 60})
            ACTIVE_API_SERVICE = "Google AI (Legacy SDK)"
            print(f"{Colors.OKGREEN}‚úÖ –õ–û–ì: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ {ACTIVE_API_SERVICE} —É—Å–ø–µ—à–Ω–∞.{Colors.ENDC}")
            print(f"{Colors.WARNING}‚ÑπÔ∏è  –õ–û–ì: –í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ thinking_budget –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –†–µ–∫–æ–º–µ–Ω–¥—É—é —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 'google-genai'.{Colors.ENDC}")
            return
        except Exception as e:
            print(f"{Colors.WARNING}‚ö†Ô∏è  –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π SDK: {e}{Colors.ENDC}")
            model = None

    # --- –†–µ–∑–µ—Ä–≤: Vertex AI (ADC/Service Account) ---
    print(f"{Colors.CYAN}üî© –õ–û–ì: –ü—ã—Ç–∞—é—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ Vertex AI SDK...{Colors.ENDC}")
    try:
        vertexai.init(project=GOOGLE_CLOUD_PROJECT, location=GOOGLE_CLOUD_LOCATION)

        # –°–æ–±–∏—Ä–∞–µ–º –∫–æ–Ω—Ñ–∏–≥ –±–µ–∑ max_output_tokens
        vertex_gen_conf = {
            "temperature": GENERATION_TEMPERATURE,
            "top_p": GENERATION_TOP_P,
            "top_k": GENERATION_TOP_K,
        }

        # –î–æ–±–∞–≤–∏–º thinking_config, –µ—Å–ª–∏ –∫–ª–∞—Å—Å –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ SDK
        if VertexThinkingConfig is not None:
            try:
                vertex_gen_conf = VertexGenerationConfig(
                    temperature=GENERATION_TEMPERATURE,
                    top_p=GENERATION_TOP_P,
                    top_k=GENERATION_TOP_K,
                    thinking_config=VertexThinkingConfig(thinking_budget=THINKING_BUDGET_TOKENS),
                )
            except Exception:
                # –ï—Å–ª–∏ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–µ—Ä–µ–¥–∞–¥–∏–º —Å–ª–æ–≤–∞—Ä—å (–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç dict)
                vertex_gen_conf = {
                    "temperature": GENERATION_TEMPERATURE,
                    "top_p": GENERATION_TOP_P,
                    "top_k": GENERATION_TOP_K,
                    "thinking_config": {"thinking_budget": THINKING_BUDGET_TOKENS},
                }

        model = GenerativeModel(
            model_name=MODEL_NAME,
            generation_config=vertex_gen_conf,
            safety_settings={
                HarmCategory.HARM_CATEGORY_HARASSMENT: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,
                HarmCategory.HARM_CATEGORY_HATE_SPEECH: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,
                HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,
                HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT: HarmBlockThreshold.BLOCK_NONE,
            }
        )
        ACTIVE_API_SERVICE = "Vertex AI"
        # –ü—Ä–æ–±–Ω—ã–π –≤—ã–∑–æ–≤
        _ = model.generate_content("ping")
        print(f"{Colors.OKGREEN}‚úÖ –õ–û–ì: Vertex AI SDK —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω.{Colors.ENDC}")
    except Exception as e:
        print(f"{Colors.FAIL}‚ùå –õ–û–ì: –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å: {e}{Colors.ENDC}")
        model = None
        ACTIVE_API_SERVICE = "N/A"

def get_active_service_details():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â—É—é –º–æ–¥–µ–ª—å/–∫–ª–∏–µ–Ω—Ç –∏ –∏–º—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞."""
    return model, ACTIVE_API_SERVICE

def _extract_text_and_usage_from_genai_response(resp):
    # –ü—ã—Ç–∞–µ–º—Å—è –≤–∑—è—Ç—å —Ç–µ–∫—Å—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –Ω–∞–¥—ë–∂–Ω–æ
    full_text = getattr(resp, "text", None)
    if not full_text:
        try:
            # google-genai –∏–Ω–æ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç candidates
            cands = getattr(resp, "candidates", None) or []
            parts_text = []
            for c in cands:
                try:
                    ct = getattr(c, "content", None)
                    if ct and getattr(ct, "parts", None):
                        for p in ct.parts:
                            t = getattr(p, "text", None)
                            if t:
                                parts_text.append(t)
                except Exception:
                    pass
            full_text = "".join(parts_text) if parts_text else ""
        except Exception:
            full_text = ""

    # usage
    prompt_tokens = 0
    output_tokens = 0
    try:
        um = getattr(resp, "usage_metadata", None)
        if um:
            prompt_tokens = getattr(um, "prompt_token_count", getattr(um, "input_tokens", 0)) or 0
            output_tokens = getattr(um, "candidates_token_count", getattr(um, "output_tokens", 0)) or 0
    except Exception:
        pass
    return full_text, prompt_tokens, output_tokens

def send_request_to_model(model_instance, active_service, prompt_text, iteration_count=0):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å —Å —Ç–µ–∫—Å—Ç–æ–º –æ—Ç–≤–µ—Ç–∞ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–æ–∫–µ–Ω–∞—Ö."""
    global GOOGLE_AI_HAS_FAILED_THIS_SESSION

    try:
        log_header = f"[–ò—Ç–µ—Ä–∞—Ü–∏—è {iteration_count}]" if iteration_count > 0 else "[–≠—Ç–∞–ø –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è]"
        print(f"{Colors.CYAN}üß† –õ–û–ì: {log_header} –ì–æ—Ç–æ–≤–ª—é –∑–∞–ø—Ä–æ—Å –≤ –º–æ–¥–µ–ª—å ({active_service}).{Colors.ENDC}")
        print(f"{Colors.CYAN}‚è≥ –õ–û–ì: –û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–ø—Ä–æ—Å... (—Ç–∞–π–º–∞—É—Ç: {API_TIMEOUT_SECONDS} —Å–µ–∫){Colors.ENDC}")

        if active_service == "Google GenAI SDK":
            # –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç + thinking_config
            cfg = GenerateContentConfig(
                temperature=GENERATION_TEMPERATURE,
                top_p=GENERATION_TOP_P,
                top_k=GENERATION_TOP_K,
                # –∫—Ä–∏—Ç–∏—á–Ω–æ: –Ω–µ –∑–∞–¥–∞—ë–º max_output_tokens
                thinking_config=ThinkingConfig(thinking_budget=THINKING_BUDGET_TOKENS),
            )
            response = model_instance.models.generate_content(
                model=MODEL_NAME,
                contents=prompt_text,
                config=cfg,
            )
            text, in_tok, out_tok = _extract_text_and_usage_from_genai_response(response)

        elif active_service == "Google AI (Legacy SDK)":
            # –°—Ç–∞—Ä—ã–π generativeai; thinking —Ç—É—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, max_output_tokens –Ω–µ –∑–∞–¥–∞–µ–º
            request_options = {"timeout": API_TIMEOUT_SECONDS}
            response = model_instance.generate_content(prompt_text, request_options=request_options)
            # –°–∫–ª–µ–π–∫–∞ –æ—Ç–≤–µ—Ç–∞
            text = getattr(response, "text", None)
            if not text:
                try:
                    text = "".join(part.text for part in response.parts)
                except Exception:
                    text = str(response)
            # usage
            in_tok = 0
            out_tok = 0
            try:
                um = response.usage_metadata
                in_tok = getattr(um, "prompt_token_count", 0) or 0
                out_tok = getattr(um, "candidates_token_count", 0) or 0
            except Exception:
                pass

        elif active_service == "Vertex AI":
            response = model_instance.generate_content(prompt_text)
            text = getattr(response, "text", None)
            if not text:
                try:
                    text = "".join(part.text for part in response.parts)
                except Exception:
                    text = str(response)
            in_tok = 0
            out_tok = 0
            try:
                um = response.usage_metadata
                in_tok = getattr(um, "prompt_token_count", 0) or 0
                out_tok = getattr(um, "candidates_token_count", 0) or 0
            except Exception:
                pass

        else:
            raise ValueError(f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å API: {active_service}")

        if not text:
            raise ValueError("–û—Ç–≤–µ—Ç –æ—Ç –º–æ–¥–µ–ª–∏ –ø—É—Å—Ç–æ–π.")

        print(f"{Colors.OKGREEN}‚úÖ –õ–û–ì: –û—Ç–≤–µ—Ç –æ—Ç –º–æ–¥–µ–ª–∏ –ø–æ–ª—É—á–µ–Ω —É—Å–ø–µ—à–Ω–æ.{Colors.ENDC}")
        return {"text": text, "input_tokens": in_tok, "output_tokens": out_tok}

    except Exception as e:
        print(f"{Colors.FAIL}‚ùå –õ–û–ì: –û–®–ò–ë–ö–ê –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ API ({active_service}): {e}{Colors.ENDC}")
        # –ê–≤—Ç–æ–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ: –ø—Ä–∏ —Å–±–æ–µ GenAI SDK –ø—Ä–æ–±—É–µ–º Vertex
        if active_service == "Google GenAI SDK":
            print(f"{Colors.CYAN}üîÑ –õ–û–ì: –ü–µ—Ä–µ–∫–ª—é—á–∞—é—Å—å –Ω–∞ Vertex AI –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤...{Colors.ENDC}")
            GOOGLE_AI_HAS_FAILED_THIS_SESSION = True
            initialize_model()
        return None

def get_command_rules(stage='execution', boundary=None):
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —ç—Ç–∞–ø–∞ (–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ).
    """
    boundary_instr = ""
    if boundary:
        boundary_instr = f"""
**–§–æ—Ä–º–∞—Ç write_file —Å BOUNDARY (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω):**
```write_file path="path/to/file" boundary="{boundary}"
<–ª—é–±–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Ñ–∞–π–ª–∞, –≤ —Ç.—á. —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ ```
 –∏ ```bash –±–ª–æ–∫–∞–º–∏>
{boundary}

–ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–æ–∫–∞ –ü–ï–†–ï–î –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º ``` ‚Äî —Ä–æ–≤–Ω–æ {boundary}.
"""

    base_rules = f"""
**–ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–†–ê–í–ò–õ–ê (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´ –ö –ò–°–ü–û–õ–ù–ï–ù–ò–Æ):**

1.  **–ü–†–ê–í–ò–õ–û –ü–£–¢–ï–ô (–°–ê–ú–û–ï –í–ê–ñ–ù–û–ï!):**
    *   –í—Å–µ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å (–≤ –±–ª–æ–∫–∞—Ö `files`, `write_file`, `bash`), –î–û–õ–ñ–ù–´ –±—ã—Ç—å **–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º–∏ –æ—Ç –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞**.
    *   **–ö–ê–¢–ï–ì–û–†–ò–ß–ï–°–ö–ò –ó–ê–ü–†–ï–©–ï–ù–û** –Ω–∞—á–∏–Ω–∞—Ç—å –ø—É—Ç—å —Å –∏–º–µ–Ω–∏ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞.
    *   **–ü—Ä–∏–º–µ—Ä:** –ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ `/path/to/my-project`, –∏ —Ç–µ–±–µ –Ω—É–∂–µ–Ω —Ñ–∞–π–ª `src/app.js`:
        *   **–ü–†–ê–í–ò–õ–¨–ù–û:** `src/app.js`
        *   **–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:** `my-project/src/app.js`

2.  **–†–∞–±–æ—á–∞—è –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:** –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∏–∑ **–∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞**. **–ó–ê–ü–†–ï–©–ï–ù–û** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `cd`.

3.  **–†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –ö–æ–º–∞–Ω–¥—ã:** `{', '.join(ALLOWED_COMMANDS)}`. –ö–æ–º–∞–Ω–¥—ã, –Ω–µ –≤—Ö–æ–¥—è—â–∏–µ –≤ —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫, –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–º–µ—â–µ–Ω—ã –≤ –±–ª–æ–∫ ```manual```.

4.  **–§–æ–∫—É—Å –∏ –ü—Ä–∞–≥–º–∞—Ç–∏–∑–º:** –¢–≤–æ—è –≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî —Ä–µ—à–∏—Ç—å **–∏—Å—Ö–æ–¥–Ω—É—é –∑–∞–¥–∞—á—É** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ù–µ –∑–∞–Ω–∏–º–∞–π—Å—è –ø–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏–∑–º–æ–º: –Ω–µ –∏—Å–ø—Ä–∞–≤–ª—è–π —Å—Ç–∏–ª—å –∫–æ–¥–∞ –∏ –Ω–µ –¥–µ–ª–∞–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –∑–∞–¥–∞—á–µ–π.
"""

    if stage == 'execution':
        return f"""
–¢—ã ‚Äî AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

**–ü–†–ê–í–ò–õ–ê –≠–¢–ê–ü–ê –ò–°–ü–û–õ–ù–ï–ù–ò–Ø:**

1.  **–ü–†–ê–í–ò–õ–û ‚Ññ1: –¢–û–õ–¨–ö–û `write_file`**
    *   –î–ª—è **—Å–æ–∑–¥–∞–Ω–∏—è –ù–û–í–´–•** –∏–ª–∏ **–∏–∑–º–µ–Ω–µ–Ω–∏—è –°–£–©–ï–°–¢–í–£–Æ–©–ò–•** —Ñ–∞–π–ª–æ–≤ —Ç—ã **–û–ë–Ø–ó–ê–ù** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **—Ç–æ–ª—å–∫–æ** –±–ª–æ–∫ ```write_file```.
    *   –≠—Ç–æ—Ç –±–ª–æ–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∞–π–ª.

2.  **–ü–†–ê–í–ò–õ–û ‚Ññ2: –ü–û–õ–ù–û–¢–ê –ö–û–î–ê (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!)**
    *   –í–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ ```write_file``` —Ç—ã –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å **–ü–û–õ–ù–û–ï –°–û–î–ï–†–ñ–ò–ú–û–ï** —Ñ–∞–π–ª–∞ –æ—Ç –ø–µ—Ä–≤–æ–π –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ—á–∫–∏.
    *   **–ö–ê–¢–ï–ì–û–†–ò–ß–ï–°–ö–ò –ó–ê–ü–†–ï–©–ï–ù–û** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã, –º–Ω–æ–≥–æ—Ç–æ—á–∏—è (`...`), –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (`// ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥`) –∏–ª–∏ –ª—é–±—ã–µ –¥—Ä—É–≥–∏–µ —Å–ø–æ—Å–æ–±—ã —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è –∫–æ–¥–∞.

3.  **–§–æ—Ä–º–∞—Ç –û—Ç–≤–µ—Ç–∞:**
    *   **–î–µ–π—Å—Ç–≤–∏—è:** –¢–≤–æ–π –æ—Ç–≤–µ—Ç **–û–ë–Ø–ó–ê–ù** —Å–æ–¥–µ—Ä–∂–∞—Ç—å –û–î–ò–ù –∏–∑ –±–ª–æ–∫–æ–≤ –¥–µ–π—Å—Ç–≤–∏–π –∏ –°–†–ê–ó–£ –ü–û–°–õ–ï –Ω–µ–≥–æ –±–ª–æ–∫ `summary`:
        1.  **–î–ª—è –∫–æ–º–∞–Ω–¥ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞:** ```bash ... ```.
        2.  **–î–ª—è –°–û–ó–î–ê–ù–ò–Ø/–ò–ó–ú–ï–ù–ï–ù–ò–Ø —Ñ–∞–π–ª–∞:** ```write_file path/to/file.py ... ```.
    *   **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ:** –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ —Ä–µ—à–µ–Ω–∞, –Ω–∞–ø–∏—à–∏ **—Ç–æ–ª—å–∫–æ** `–ì–û–¢–û–í–û`, –∑–∞—Ç–µ–º –±–ª–æ–∫ ```done_summary ... ```. –î–ª—è —Ä—É—á–Ω—ã—Ö —à–∞–≥–æ–≤ –¥–æ–±–∞–≤—å –±–ª–æ–∫ ```manual```.

{base_rules}
{boundary_instr}
"""

    if stage == 'planning':
        return f"""
–¢—ã ‚Äî AI-–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫. –ü–µ—Ä–≤–∞—è –∑–∞–¥–∞—á–∞ ‚Äî —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏—Å—Ö–æ–¥–Ω–∞—è –∑–∞–¥–∞—á–∞ –ø–æ–Ω—è—Ç–Ω–∞.

**–ü–†–ê–í–ò–õ–ê –ü–õ–ê–ù–ò–†–û–í–ê–ù–ò–Ø:**

1.  –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –∑–∞–¥–∞—á—É –∏ **—Å–æ–∫—Ä–∞—â—ë–Ω–Ω—ã–π** –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞.
2.  **–î–≤–∞ –ø—É—Ç–∏**:
    *   –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ **–Ω–µ–ø–æ–Ω—è—Ç–Ω–∞** ‚Äî –≤–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ ```clarification ... ```.
    *   –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ **–ø–æ–Ω—è—Ç–Ω–∞** ‚Äî –≤–µ—Ä–Ω–∏ ```plan ... ``` –∏ ```files ... ```.
3.  –ó–∞–ø—Ä–µ—â–µ–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å ```bash``` –∏–ª–∏ `write_file` –Ω–∞ —ç—Ç–∞–ø–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.

{base_rules}
{boundary_instr}
"""

def get_clarification_and_planning_prompt(context, task, boundary=None):
    rules = get_command_rules(stage='planning', boundary=boundary)
    return f"""{rules}

--- –ö–û–ù–¢–ï–ö–°–¢ –ü–†–û–ï–ö–¢–ê (–°–û–ö–†–ê–©–ï–ù–ù–´–ô) ---
{context}
--- –ö–û–ù–ï–¶ –ö–û–ù–¢–ï–ö–°–¢–ê ---

--- –ó–ê–î–ê–ß–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ---
{task}
--- –ö–û–ù–ï–¶ –ó–ê–î–ê–ß–ò ---

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∑–∞–¥–∞—á—É –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç. –°–ª–µ–¥—É–π –ø—Ä–∞–≤–∏–ª–∞–º —ç—Ç–∞–ø–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.
"""

def get_initial_prompt(context, task, fix_history=None, boundary=None):
    history_prompt_section = ""
    if fix_history:
        history_prompt_section = f"""
--- –ò–°–¢–û–†–ò–Ø –ü–†–ï–î–´–î–£–©–ï–ì–û –†–ï–®–ï–ù–ò–Ø, –ö–û–¢–û–†–û–ï –û–ö–ê–ó–ê–õ–û–°–¨ –ù–ï–í–ï–†–ù–´–ú ---
{fix_history}
--- –ö–û–ù–ï–¶ –ò–°–¢–û–†–ò–ò ---
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–≤–æ—é –ø—Ä–æ—à–ª—É—é –æ—à–∏–±–∫—É –∏ –Ω–∞—á–Ω–∏ –∑–∞–Ω–æ–≤–æ.
"""
    return f"""{get_command_rules(stage='execution', boundary=boundary)}
{history_prompt_section}
--- –ö–û–ù–¢–ï–ö–°–¢ –ü–†–û–ï–ö–¢–ê (–ü–û–õ–ù–´–ô –ò–õ–ò –ß–ê–°–¢–ò–ß–ù–´–ô) ---
{context}
--- –ö–û–ù–ï–¶ –ö–û–ù–¢–ï–ö–°–¢–ê ---
–ó–∞–¥–∞—á–∞: {task}
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∑–∞–¥–∞—á—É –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å –æ—Ç–≤–µ—Ç, —Å—Ç—Ä–æ–≥–æ —Å–ª–µ–¥—É—è –ø—Ä–∞–≤–∏–ª–∞–º –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.
"""

def get_review_prompt(context, goal, iteration_count, attempt_history, boundary=None):
    iteration_info = ""
    if iteration_count >= 4:
        iteration_info = f"\n**–û–°–û–ë–û–ï –í–ù–ò–ú–ê–ù–ò–ï (–ò—Ç–µ—Ä–∞—Ü–∏—è {iteration_count}):** –°–¥–µ–ª–∞–Ω–æ —É–∂–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —à–∞–≥–æ–≤ ‚Äî –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø—Ä–æ–±–ª–µ–º—É –≥–ª—É–±–∂–µ.\n"
    history_info = ""
    if attempt_history:
        history_info = (
            "--- –ò–°–¢–û–†–ò–Ø –ü–†–ï–î–´–î–£–©–ò–• –ü–û–ü–´–¢–û–ö ---\n" +
            "\n---\n".join(attempt_history) +
            "\n--- –ö–û–ù–ï–¶ –ò–°–¢–û–†–ò–ò ---\n"
        )
    return f"""{get_command_rules(stage='execution', boundary=boundary)}
{iteration_info}
{history_info}
**–í–ê–ñ–ù–û:** –ü—Ä–µ–¥—ã–¥—É—â–∏–π —à–∞–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω. –ö–æ–¥ –Ω–∏–∂–µ ‚Äî —ç—Ç–æ **–æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ** –ø—Ä–æ–µ–∫—Ç–∞.

**–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –í–ï–†–ò–§–ò–ö–ê–¶–ò–Ø:**
1) –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–µ–∫—É—â–∏–π –∫–æ–¥ —Å —É—á—ë—Ç–æ–º –∏—Å—Ç–æ—Ä–∏–∏.
2) –ï—Å–ª–∏ —Ü–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ ‚Äî –Ω–∞–ø–∏—à–∏ `–ì–û–¢–û–í–û`.
3) –ò–Ω–∞—á–µ ‚Äî –¥–∞–π —Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π –∏ `summary`.

--- –ö–û–ù–¢–ï–ö–°–¢ –ü–†–û–ï–ö–¢–ê (–û–ë–ù–û–í–õ–Å–ù–ù–´–ô) ---
{context}
--- –ö–û–ù–ï–¶ –ö–û–ù–¢–ï–ö–°–¢–ê ---

–ù–∞–ø–æ–º–∏–Ω–∞—é –ò–°–•–û–î–ù–£–Æ –¶–ï–õ–¨: {goal}
"""

def get_error_fixing_prompt(failed_command, error_message, goal, context, iteration_count, attempt_history, boundary=None):
    iteration_info = ""
    if iteration_count >= 4:
        iteration_info = f"\n**–û–°–û–ë–û–ï –í–ù–ò–ú–ê–ù–ò–ï (–ò—Ç–µ—Ä–∞—Ü–∏—è {iteration_count}):** –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ ‚Äî –ø–æ–¥—É–º–∞–π —à–∏—Ä–µ –∏ –∏—Å–ø—Ä–∞–≤—å –µ—ë –Ω–∞–¥—ë–∂–Ω–æ.\n"
    history_info = ""
    if attempt_history:
        history_info = (
            "--- –ò–°–¢–û–†–ò–Ø –ü–†–ï–î–´–î–£–©–ò–• –ü–û–ü–´–¢–û–ö ---\n" +
            "\n---\n".join(attempt_history) +
            "\n--- –ö–û–ù–ï–¶ –ò–°–¢–û–†–ò–ò ---\n"
        )
    return f"""{get_command_rules(stage='execution', boundary=boundary)}
{iteration_info}
{history_info}
**–í–ê–ñ–ù–û:** –ò—Å–ø—Ä–∞–≤—å –æ—à–∏–±–∫—É. –ù–µ –ø–∏—à–∏ `–ì–û–¢–û–í–û`.

--- –î–ê–ù–ù–´–ï –û–ë –û–®–ò–ë–ö–ï ---
–ö–û–ú–ê–ù–î–ê: {failed_command}
–°–û–û–ë–©–ï–ù–ò–ï (stderr): {error_message}
--- –ö–û–ù–ï–¶ –î–ê–ù–ù–´–• –û–ë –û–®–ò–ë–ö–ï ---

–ò—Å—Ö–æ–¥–Ω–∞—è –¶–ï–õ–¨ –±—ã–ª–∞: {goal}

–î–∞–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –±–ª–æ–∫ –∫–æ–º–∞–Ω–¥ –∏ `summary`.

--- –ö–û–ù–¢–ï–ö–°–¢, –ì–î–ï –ü–†–û–ò–ó–û–®–õ–ê –û–®–ò–ë–ö–ê ---
{context}
--- –ö–û–ù–ï–¶ –ö–û–ù–¢–ï–ö–°–¢–ê ---
"""


–§–∞–π–ª: sloth_history.json
------------------------
{
  "last_run_config": {
    "target_project_path": "/Users/vladimirdoronin/VovkaNowEngineer/tutor-game-new",
    "is_fast_mode": false
  },
  "previous_attempts": [
    {
      "initial_goal": "–ù–∞—É—á–∏ –º–µ–Ω—è –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç, –∫–∞–∂–µ—Ç—Å—è —Ç–∞–º –±—ã–ª —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞, –∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å —á—Ç–æ–±—ã –≤—Å–µ —Ä–∞–±–æ—Ç–∞–ª–æ, –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –∏ –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±",
      "solution_summary": "–Ø —Å–æ–∑–¥–∞–ª —Ñ–∞–π–ª README.md —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ –∑–∞–ø—É—Å–∫—É, –∫–∞–∫ –∏ –ø—Ä–æ—Å–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. –≠—Ç–æ—Ç —Ñ–∞–π–ª —Ç–µ–ø–µ—Ä—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å–ª—É–∂–∏—Ç –µ–¥–∏–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —Å—Ç–∞—Ä—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ó–∞–¥–∞—á–∞ —Ä–µ—à–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é."
    }
  ]
}

–§–∞–π–ª: sloth_run.log
-------------------
# SLOTH RUN LOG
# –¶–µ–ª–µ–≤–æ–π –ø—Ä–æ–µ–∫—Ç: /Users/vladimirdoronin/VovkaNowEngineer/tutor-game-new
# –†–µ–∂–∏–º: –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π

================================================================================
–ó–ê–ü–†–û–° (–°–æ—Å—Ç–æ—è–Ω–∏–µ: PLANNING, –ò—Ç–µ—Ä–∞—Ü–∏—è: 0)
--------------------------------------------------------------------------------

–¢—ã ‚Äî AI-–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫. –ü–µ—Ä–≤–∞—è –∑–∞–¥–∞—á–∞ ‚Äî —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏—Å—Ö–æ–¥–Ω–∞—è –∑–∞–¥–∞—á–∞ –ø–æ–Ω—è—Ç–Ω–∞.

**–ü–†–ê–í–ò–õ–ê –ü–õ–ê–ù–ò–†–û–í–ê–ù–ò–Ø:**

1.  –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –∑–∞–¥–∞—á—É –∏ **—Å–æ–∫—Ä–∞—â—ë–Ω–Ω—ã–π** –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞.
2.  **–î–≤–∞ –ø—É—Ç–∏**:
    *   –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ **–Ω–µ–ø–æ–Ω—è—Ç–Ω–∞** ‚Äî –≤–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ ```clarification ... ```.
    *   –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ **–ø–æ–Ω—è—Ç–Ω–∞** ‚Äî –≤–µ—Ä–Ω–∏ ```plan ... ``` –∏ ```files ... ```.
3.  –ó–∞–ø—Ä–µ—â–µ–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å ```bash``` –∏–ª–∏ `write_file` –Ω–∞ —ç—Ç–∞–ø–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.


**–ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–†–ê–í–ò–õ–ê (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´ –ö –ò–°–ü–û–õ–ù–ï–ù–ò–Æ):**

1.  **–ü–†–ê–í–ò–õ–û –ü–£–¢–ï–ô (–°–ê–ú–û–ï –í–ê–ñ–ù–û–ï!):**
    *   –í—Å–µ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å (–≤ –±–ª–æ–∫–∞—Ö `files`, `write_file`, `bash`), –î–û–õ–ñ–ù–´ –±—ã—Ç—å **–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º–∏ –æ—Ç –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞**.
    *   **–ö–ê–¢–ï–ì–û–†–ò–ß–ï–°–ö–ò –ó–ê–ü–†–ï–©–ï–ù–û** –Ω–∞—á–∏–Ω–∞—Ç—å –ø—É—Ç—å —Å –∏–º–µ–Ω–∏ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞.
    *   **–ü—Ä–∏–º–µ—Ä:** –ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ `/path/to/my-project`, –∏ —Ç–µ–±–µ –Ω—É–∂–µ–Ω —Ñ–∞–π–ª `src/app.js`:
        *   **–ü–†–ê–í–ò–õ–¨–ù–û:** `src/app.js`
        *   **–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:** `my-project/src/app.js`

2.  **–†–∞–±–æ—á–∞—è –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:** –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∏–∑ **–∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞**. **–ó–ê–ü–†–ï–©–ï–ù–û** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `cd`.

3.  **–†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –ö–æ–º–∞–Ω–¥—ã:** `rm, mv, touch, mkdir, npm, npx, yarn, pnpm, git, echo, ./`. –ö–æ–º–∞–Ω–¥—ã, –Ω–µ –≤—Ö–æ–¥—è—â–∏–µ –≤ —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫, –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–º–µ—â–µ–Ω—ã –≤ –±–ª–æ–∫ ```manual```.

4.  **–§–æ–∫—É—Å –∏ –ü—Ä–∞–≥–º–∞—Ç–∏–∑–º:** –¢–≤–æ—è –≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî —Ä–µ—à–∏—Ç—å **–∏—Å—Ö–æ–¥–Ω—É—é –∑–∞–¥–∞—á—É** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ù–µ –∑–∞–Ω–∏–º–∞–π—Å—è –ø–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏–∑–º–æ–º: –Ω–µ –∏—Å–ø—Ä–∞–≤–ª—è–π —Å—Ç–∏–ª—å –∫–æ–¥–∞ –∏ –Ω–µ –¥–µ–ª–∞–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –∑–∞–¥–∞—á–µ–π.


**–§–æ—Ä–º–∞—Ç write_file —Å BOUNDARY (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω):**
```write_file path="path/to/file" boundary="SLOTH_BOUNDARY_070162a1463b4766a0640e529949ed46"
<–ª—é–±–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Ñ–∞–π–ª–∞, –≤ —Ç.—á. —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ ```
 –∏ ```bash –±–ª–æ–∫–∞–º–∏>
SLOTH_BOUNDARY_070162a1463b4766a0640e529949ed46

–ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–æ–∫–∞ –ü–ï–†–ï–î –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º ``` ‚Äî —Ä–æ–≤–Ω–æ SLOTH_BOUNDARY_070162a1463b4766a0640e529949ed46.



--- –ö–û–ù–¢–ï–ö–°–¢ –ü–†–û–ï–ö–¢–ê (–°–û–ö–†–ê–©–ï–ù–ù–´–ô) ---
–°–µ–π—á–∞—Å —è –≤—ã–≥—Ä—É–∂—É –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞: —Å–Ω–∞—á–∞–ª–∞ –¥–µ—Ä–µ–≤–æ —Ñ–∞–π–ª–æ–≤ —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏ –≤ —Å–∏–º–≤–æ–ª–∞—Ö, –∞ –ø–æ—Ç–æ–º –∏—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ.

--- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ ---
tutor-game-new/
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.ts (2928 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ websocket.ts (739 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ context/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SocketContext.tsx (541 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ locales/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ru/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ translation.json (16998 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ en/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ translation.json (16324 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts (106 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useAppDispatch.ts (305 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useAppSelector.ts (185 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ apiSlice.ts (418 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ axiosBaseQuery.ts (1500 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ store.ts (801 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ features/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Chat.tsx (6539 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chatApi.ts (601 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ chatSlice.ts (2844 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authApi.ts (4588 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ authSlice.ts (3370 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ student/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ adventureSlice.ts (1773 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ studentApi.ts (3518 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lesson/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lessonApi.ts (4505 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ teacher/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StudentsPage.tsx (5798 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ teacherApi.ts (2085 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ goal/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ goalApi.ts (6184 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ common/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Layout.tsx (18081 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Spinner.tsx (645 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ WebSocketManager.tsx (7900 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ icons/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ index.ts (150 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ChatPage.tsx (933 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ student/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CompletedLessonsPage.tsx (5904 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StoryHistoryPage.tsx (4448 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ !!!StudentAdventurePage.tsx (27808 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StudentDashboard.tsx (4404 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ StudentStoriesListPage.tsx (2645 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ teacher/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CharacterEditor.tsx (8637 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ControlWorkContentEditor.tsx (7310 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LessonContentEditor.tsx (10291 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LessonStatusIndicator.tsx (1296 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LessonStoryEditor.tsx (11097 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RoadmapSection.tsx (12172 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CreateGoalPage.tsx (6966 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LearningGoalsListPage.tsx (3367 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LessonEditorModal.tsx (7587 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ !!!RoadmapEditorPage.tsx (19768 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TeacherDashboard.tsx (2032 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ HomePage.tsx (6282 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoginPage.tsx (6482 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotFoundPage.tsx (1517 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RegisterPage.tsx (10655 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.tsx (4010 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthInitializer.tsx (1937 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ i18n.ts (866 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.css (10114 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tsx (687 chars)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ vite-env.d.ts (204 chars)
‚îÇ   ‚îú‚îÄ‚îÄ index.html (1033 chars)
‚îÇ   ‚îú‚îÄ‚îÄ package.json (1303 chars)
‚îÇ   ‚îú‚îÄ‚îÄ postcss.config.js (80 chars)
‚îÇ   ‚îú‚îÄ‚îÄ tailwind.config.js (3081 chars)
‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json (793 chars)
‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.node.json (511 chars)
‚îÇ   ‚îî‚îÄ‚îÄ vite.config.ts (1373 chars)
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20250622134108_final_schema_update/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql (7197 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20250706111311_remove_obsolete_story_model/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql (339 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20250622202034_add_character_and_story_models/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql (1121 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20250708100000_add_illustration_style/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql (112 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20250623091331_add_image_prompt_to_story_chapter/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql (945 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20250622144309_add_language_to_goal/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql (102 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20250707120000_remove_badges/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql (153 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20250623153940_enhance_performance_log/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql (155 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20250623180646_make_log_fields_optional/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql (2078 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20250719195723_add_control_work_lesson_type/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql (63 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration_lock.toml (128 chars)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma (6235 chars)
‚îÇ   ‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ check-db.ts (817 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ createTestUsers.ts (4550 chars)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lowercase-emails.ts (2380 chars)
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ env.ts (2623 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middlewares/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.middleware.ts (1266 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ teacher.middleware.ts (937 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ errors.ts (1236 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fileUpload.ts (1807 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logger.ts (2445 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.ts (9772 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ character.controller.ts (6168 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat.controller.ts (905 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ goal.controller.ts (5466 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lesson.controller.ts (5886 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ performanceLogs.controller.ts (1519 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ roadmap.controller.ts (6124 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ story.controller.ts (13301 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ student.controller.ts (16801 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ teacher.controller.ts (3101 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.routes.ts (674 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ character.routes.ts (779 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat.routes.ts (452 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ goal.routes.ts (770 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ image.routes.ts (466 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lesson.routes.ts (715 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ roadmap.routes.ts (554 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ story.routes.ts (956 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ student.routes.ts (1482 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ teacher.routes.ts (951 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.service.ts (8499 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat.service.ts (1691 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ !!!gemini.service.ts (22583 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ leonardo.service.ts (6637 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ websocket.service.ts (7143 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app.ts (4619 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db.ts (895 chars)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts (912 chars)
‚îÇ   ‚îú‚îÄ‚îÄ .env (1473 chars)
‚îÇ   ‚îú‚îÄ‚îÄ .env.example (505 chars)
‚îÇ   ‚îú‚îÄ‚îÄ package.json (1430 chars)
‚îÇ   ‚îú‚îÄ‚îÄ start.sh (332 chars)
‚îÇ   ‚îî‚îÄ‚îÄ tsconfig.json (386 chars)
‚îî‚îÄ‚îÄ package.json (1191 chars)

--- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–æ–≤ ---

–§–∞–π–ª: backend/.env
------------------
[Content of file .env truncated. First 10 lines:]
# tutor-game/backend/.env

# --- Server Configuration ---
NODE_ENV=development
PORT=3002

# --- Database Configuration ---
# URL –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ç–≤–æ–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
DATABASE_URL="postgresql://vladimirdoronin@localhost:5432/tutor_game?schema=public"


–§–∞–π–ª: backend/.env.example
--------------------------
[Content of file .env.example truncated. First 10 lines:]
# Server Configuration
PORT=3001
NODE_ENV=development

# JWT Configuration
JWT_SECRET=your_jwt_secret_key_here
JWT_EXPIRES_IN=7d

# Database Configuration
DATABASE_URL=postgresql://username:password@localhost:5432/math_quest?schema=public

–§–∞–π–ª: backend/package.json
--------------------------
{
  "name": "backend",
  "version": "1.0.0",
  "main": "dist/index.js",
  "scripts": {
    "build": "tsc",
    "dev": "ts-node-dev --respawn --transpile-only src/index.ts",
    "start": "./start.sh",
    "prisma:generate": "prisma generate",
    "prisma:migrate": "prisma migrate dev",

[... content truncated ...]

    "prisma": "^6.8.2",
    "ts-node-dev": "^2.0.0",
    "typescript": "^5.0.0"
  }
}

–§–∞–π–ª: backend/prisma/migrations/20250622134108_final_schema_update/migration.sql
--------------------------------------------------------------------------------
[Content of file migration.sql truncated. First 10 lines:]
-- CreateEnum
CREATE TYPE "Role" AS ENUM ('STUDENT', 'TEACHER');

-- CreateEnum
CREATE TYPE "LessonType" AS ENUM ('THEORY', 'PRACTICE', 'WITH_TEACHER');

-- CreateEnum
CREATE TYPE "LessonStatus" AS ENUM ('DRAFT', 'PENDING_APPROVAL', 'APPROVED', 'COMPLETED');

-- CreateEnum

–§–∞–π–ª: backend/prisma/migrations/20250622144309_add_language_to_goal/migration.sql
---------------------------------------------------------------------------------
-- AlterTable
ALTER TABLE "learning_goals" ADD COLUMN     "language" TEXT NOT NULL DEFAULT 'Russian';


–§–∞–π–ª: backend/prisma/migrations/20250622202034_add_character_and_story_models/migration.sql
-------------------------------------------------------------------------------------------
[Content of file migration.sql truncated. First 10 lines:]
-- AlterTable
ALTER TABLE "learning_goals" ADD COLUMN     "characterGenId" TEXT,
ADD COLUMN     "characterImageId" TEXT,
ADD COLUMN     "characterImageUrl" TEXT,
ADD COLUMN     "characterPrompt" TEXT;

-- CreateTable
CREATE TABLE "story_chapters" (
    "id" TEXT NOT NULL,
    "learningGoalId" TEXT NOT NULL,

–§–∞–π–ª: backend/prisma/migrations/20250623091331_add_image_prompt_to_story_chapter/migration.sql
----------------------------------------------------------------------------------------------
/*
  Warnings:

  - You are about to drop the column `studentResponseText` on the `story_chapters` table. All the data in the column will be lost.
  - The `teacherSnippetStatus` column on the `story_chapters` table would be dropped and recreated. This will lead to data loss if there is data in the column.
  - Added the required column `updatedAt` to the `story_chapters` table without a default value. This is not possible if the table is not empty.

*/
-- AlterTable
ALTER TABLE "story_chapters" DROP COLUMN "studentResponseText",
ADD COLUMN     "studentSnippetImageUrl" TEXT,
ADD COLUMN     "studentSnippetStatus" TEXT NOT NULL DEFAULT 'LOCKED',
ADD COLUMN     "studentSnippetText" TEXT,
ADD COLUMN     "teacherSnippetImagePrompt" TEXT,
ADD COLUMN     "updatedAt" TIMESTAMP(3) NOT NULL,
ALTER COLUMN "teacherSnippetText" DROP NOT NULL,
DROP COLUMN "teacherSnippetStatus",
ADD COLUMN     "teacherSnippetStatus" TEXT NOT NULL DEFAULT 'DRAFT';


–§–∞–π–ª: backend/prisma/migrations/20250623153940_enhance_performance_log/migration.sql
------------------------------------------------------------------------------------
-- AlterTable
ALTER TABLE "student_performance_logs" ADD COLUMN     "blockIndex" INTEGER,
ADD COLUMN     "blockType" TEXT,
ADD COLUMN     "question" TEXT;


–§–∞–π–ª: backend/prisma/migrations/20250623180646_make_log_fields_optional/migration.sql
-------------------------------------------------------------------------------------
[Content of file migration.sql truncated. First 10 lines:]
/*
  Warnings:

  - You are about to drop the column `blockIndex` on the `student_performance_logs` table. All the data in the column will be lost.
  - You are about to drop the column `blockType` on the `student_performance_logs` table. All the data in the column will be lost.
  - You are about to drop the column `createdAt` on the `student_performance_logs` table. All the data in the column will be lost.
  - You are about to drop the column `lessonId` on the `student_performance_logs` table. All the data in the column will be lost.
  - You are about to drop the column `studentId` on the `student_performance_logs` table. All the data in the column will be lost.
  - Added the required column `lesson_id` to the `student_performance_logs` table without a default value. This is not possible if the table is not empty.
  - Added the required column `student_id` to the `student_performance_logs` table without a default value. This is not possible if the table is not empty.

–§–∞–π–ª: backend/prisma/migrations/20250706111311_remove_obsolete_story_model/migration.sql
----------------------------------------------------------------------------------------
/*
  Warnings:

  - You are about to drop the `stories` table. If the table is not empty, all the data it contains will be lost.

*/
-- DropForeignKey
ALTER TABLE "stories" DROP CONSTRAINT "stories_learningGoalId_fkey";

-- DropForeignKey
ALTER TABLE "stories" DROP CONSTRAINT "stories_studentId_fkey";

-- DropTable
DROP TABLE "stories";


–§–∞–π–ª: backend/prisma/migrations/20250707120000_remove_badges/migration.sql
--------------------------------------------------------------------------
-- DropForeignKey
ALTER TABLE "badges" DROP CONSTRAINT "badges_studentId_fkey";

-- DropTable
DROP TABLE "badges";

-- DropEnum
DROP TYPE "BadgeStatus";


–§–∞–π–ª: backend/prisma/migrations/20250708100000_add_illustration_style/migration.sql
-----------------------------------------------------------------------------------
-- AlterTable
ALTER TABLE "learning_goals" ADD COLUMN "illustrationStyle" TEXT NOT NULL DEFAULT 'ILLUSTRATION';


–§–∞–π–ª: backend/prisma/migrations/20250719195723_add_control_work_lesson_type/migration.sql
-----------------------------------------------------------------------------------------
-- AlterEnum
ALTER TYPE "LessonType" ADD VALUE 'CONTROL_WORK';


–§–∞–π–ª: backend/prisma/migrations/migration_lock.toml
---------------------------------------------------
# Please do not edit this file manually
# It should be added in your version-control system (e.g., Git)
provider = "postgresql"


–§–∞–π–ª: backend/prisma/schema.prisma
----------------------------------
[Content of file schema.prisma truncated. First 10 lines:]
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")

–§–∞–π–ª: backend/scripts/check-db.ts
---------------------------------
// File: check-db.ts
// Summary of declarations:

async function checkDatabase() {
  // ... implementation
}

–§–∞–π–ª: backend/scripts/createTestUsers.ts
----------------------------------------
// File: createTestUsers.ts
// Summary of declarations:

const prisma = new PrismaClient();

async function main() {
  // ... implementation
}

–§–∞–π–ª: backend/scripts/lowercase-emails.ts
-----------------------------------------
// File: lowercase-emails.ts
// Summary of declarations:

const prisma = new PrismaClient();

async function lowercaseEmails() {
  // ... implementation
}

–§–∞–π–ª: backend/src/app.ts
------------------------
// File: app.ts
// Summary of declarations:

interface ServerWithWebSocket extends http.Server {
  // ... implementation
}

–§–∞–π–ª: backend/src/config/env.ts
-------------------------------
// File: env.ts
// Summary of declarations:

const envVars = envSchema.safeParse(process.env);

export type Config = typeof config;

–§–∞–π–ª: backend/src/controllers/auth.controller.ts
------------------------------------------------
// File: auth.controller.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/controllers/character.controller.ts
-----------------------------------------------------
// File: character.controller.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/controllers/chat.controller.ts
------------------------------------------------
// File: chat.controller.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/controllers/goal.controller.ts
------------------------------------------------
// File: goal.controller.ts
// Summary of declarations:

interface CreateGoalBody {
  // ... implementation
}

–§–∞–π–ª: backend/src/controllers/lesson.controller.ts
--------------------------------------------------
// File: lesson.controller.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/controllers/performanceLogs.controller.ts
-----------------------------------------------------------
// File: performanceLogs.controller.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/controllers/roadmap.controller.ts
---------------------------------------------------
// File: roadmap.controller.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/controllers/story.controller.ts
-------------------------------------------------
// File: story.controller.ts
// Summary of declarations:

interface Request extends ExpressRequest {
  // ... implementation
}

–§–∞–π–ª: backend/src/controllers/student.controller.ts
---------------------------------------------------
// File: student.controller.ts
// Summary of declarations:

interface Request extends ExpressRequest {
  // ... implementation
}

–§–∞–π–ª: backend/src/controllers/teacher.controller.ts
---------------------------------------------------
// File: teacher.controller.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/db.ts
-----------------------
// File: db.ts
// Summary of declarations:

const prisma = global.prisma || new PrismaClient(prismaOptions);

–§–∞–π–ª: backend/src/index.ts
--------------------------
// File: index.ts
// Summary of declarations:

const PORT = process.env.PORT || '3002';

const { server } = createServer();

–§–∞–π–ª: backend/src/middlewares/auth.middleware.ts
------------------------------------------------
// File: auth.middleware.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/middlewares/teacher.middleware.ts
---------------------------------------------------
// File: teacher.middleware.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/routes/auth.routes.ts
---------------------------------------
// File: auth.routes.ts
// Summary of declarations:

const router = Router();

–§–∞–π–ª: backend/src/routes/character.routes.ts
--------------------------------------------
// File: character.routes.ts
// Summary of declarations:

const router = Router();

–§–∞–π–ª: backend/src/routes/chat.routes.ts
---------------------------------------
// File: chat.routes.ts
// Summary of declarations:

const router = Router();

–§–∞–π–ª: backend/src/routes/goal.routes.ts
---------------------------------------
// File: goal.routes.ts
// Summary of declarations:

const router = Router();

–§–∞–π–ª: backend/src/routes/image.routes.ts
----------------------------------------
// File: image.routes.ts
// Summary of declarations:

const router = Router();

–§–∞–π–ª: backend/src/routes/lesson.routes.ts
-----------------------------------------
// File: lesson.routes.ts
// Summary of declarations:

const router = Router();

–§–∞–π–ª: backend/src/routes/roadmap.routes.ts
------------------------------------------
// File: roadmap.routes.ts
// Summary of declarations:

const router = Router();

–§–∞–π–ª: backend/src/routes/story.routes.ts
----------------------------------------
// File: story.routes.ts
// Summary of declarations:

const router = Router();

–§–∞–π–ª: backend/src/routes/student.routes.ts
------------------------------------------
// File: student.routes.ts
// Summary of declarations:

const router = Router();

–§–∞–π–ª: backend/src/routes/teacher.routes.ts
------------------------------------------
// File: teacher.routes.ts
// Summary of declarations:

const router = Router();

–§–∞–π–ª: backend/src/services/auth.service.ts
------------------------------------------
// File: auth.service.ts
// Summary of declarations:

interface SafeUser {
  // ... implementation
}

type PrismaType = typeof Prisma;

interface TokenPayload {
  // ... implementation
}

interface AuthResponse {
  // ... implementation
}

const loginAttempts = new Map<string, { count: number;

export const login = async (email: string, password: string, ipAddress: string): Promise<{ user: SafeUser;

–§–∞–π–ª: backend/src/services/chat.service.ts
------------------------------------------
// File: chat.service.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/services/gemini.service.ts
--------------------------------------------
// File: gemini.service.ts
// Summary of declarations:

const genAI = new GoogleGenerativeAI(config.geminiApiKey);

const MODEL_NAME = "gemini-2.5-flash";

const TEMP_LOW = 0.2;

const TEMP_MID = 0.45;

const TEMP_HIGH = 0.85;

function createGeminiHistory(systemPrompt: string, chatHistory: {
  // ... implementation
}

async function callGemini(prompt: string, temperature: number, isJson: boolean) {
  // ... implementation
}

async function callGeminiWithChat(history: Content[], temperature: number, isJson: boolean) {
  // ... implementation
}

–§–∞–π–ª: backend/src/services/leonardo.service.ts
----------------------------------------------
// File: leonardo.service.ts
// Summary of declarations:

const LEONARDO_API_URL = 'https://cloud.leonardo.ai/api/rest/v1';

export interface GenerateImageParams {
  // ... implementation
}

export interface GenerationResult {
  // ... implementation
}

export async function startImageGeneration(params: GenerateImageParams): Promise<{
  // ... implementation
}

export async function uploadImageToLeonardo(filePath: string): Promise<{
  // ... implementation
}

export async function getGenerationResult(generationId: string): Promise<GenerationResult> {
  // ... implementation
}

export async function generateImage(params: GenerateImageParams): Promise<GenerationResult> {
  // ... implementation
}

–§–∞–π–ª: backend/src/services/websocket.service.ts
-----------------------------------------------
// File: websocket.service.ts
// Summary of declarations:

interface AuthenticatedSocket extends Socket {
  // ... implementation
}

export class WebSocketService {
  // ... implementation
}

–§–∞–π–ª: backend/src/utils/errors.ts
---------------------------------
// File: errors.ts
// Summary of declarations:

export class AppError extends Error {
  // ... implementation
}

–§–∞–π–ª: backend/src/utils/fileUpload.ts
-------------------------------------
// File: fileUpload.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/utils/logger.ts
---------------------------------
// File: logger.ts
// Summary of declarations:

const { combine, timestamp, printf, colorize, errors } = format;

–§–∞–π–ª: backend/start.sh
----------------------
#!/bin/sh
# This script ensures the server restarts automatically after a crash.

while true; do
  echo "[Auto-Restart] Starting Node.js server..."
  # We run the command that directly starts the node process
  node dist/index.js
  echo "[Auto-Restart] Server process exited with code $?. Restarting in 3 seconds..."
  sleep 3
done


–§–∞–π–ª: backend/tsconfig.json
---------------------------
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "moduleResolution": "node",
    "resolveJsonModule": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "**/*.test.ts"]
}


–§–∞–π–ª: frontend/index.html
-------------------------
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#4f46e5" />
    <title>Math Quest</title>
    <base href="/" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

[... content truncated ...]

        }
      });
    </script>
  </body>
</html>

–§–∞–π–ª: frontend/package.json
---------------------------
{
  "name": "frontend",
  "private": true,
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "preview": "vite preview"

[... content truncated ...]

    "tailwindcss": "^3.4.1",
    "typescript": "^5.4.2",
    "vite": "^5.1.6"
  }
}

–§–∞–π–ª: frontend/postcss.config.js
--------------------------------
// File: postcss.config.js
// No top-level declarations found.

–§–∞–π–ª: frontend/src/App.tsx
--------------------------
// File: App.tsx
// Summary of declarations:

function App() {
  // ... implementation
}

–§–∞–π–ª: frontend/src/AuthInitializer.tsx
--------------------------------------
// File: AuthInitializer.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/app/api/apiSlice.ts
--------------------------------------
// File: apiSlice.ts
// No top-level declarations found.

–§–∞–π–ª: frontend/src/app/api/axiosBaseQuery.ts
--------------------------------------------
// File: axiosBaseQuery.ts
// No top-level declarations found.

–§–∞–π–ª: frontend/src/app/hooks/index.ts
-------------------------------------
// File: index.ts
// No top-level declarations found.

–§–∞–π–ª: frontend/src/app/hooks/useAppDispatch.ts
----------------------------------------------
// File: useAppDispatch.ts
// Summary of declarations:

type TypedDispatch = ThunkDispatch<RootState, unknown, UnknownAction>;

export const useAppDispatch = (): TypedDispatch => useDispatch<TypedDispatch>();

–§–∞–π–ª: frontend/src/app/hooks/useAppSelector.ts
----------------------------------------------
// File: useAppSelector.ts
// Summary of declarations:

export const useAppSelector: TypedUseSelectorHook<RootState> = useSelector;

–§–∞–π–ª: frontend/src/app/store.ts
-------------------------------
// File: store.ts
// Summary of declarations:

export type RootState = ReturnType<typeof store.getState>;

export type AppDispatch = typeof store.dispatch;

–§–∞–π–ª: frontend/src/components/common/Layout.tsx
-----------------------------------------------
// File: Layout.tsx
// Summary of declarations:

interface NavigationItem {
  // ... implementation
}

function getStudentNavigation(t: (key: string) => string): NavigationItem[] {
  // ... implementation
}

function getTeacherNavigation(t: (key: string) => string): NavigationItem[] {
  // ... implementation
}

function classNames(...classes: (string | boolean | undefined)[]): string {
  // ... implementation
}

–§–∞–π–ª: frontend/src/components/common/Spinner.tsx
------------------------------------------------
// File: Spinner.tsx
// Summary of declarations:

type SpinnerSize = 'sm' | 'md' | 'lg';

interface SpinnerProps {
  // ... implementation
}

–§–∞–π–ª: frontend/src/components/common/WebSocketManager.tsx
---------------------------------------------------------
// File: WebSocketManager.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/components/icons/index.ts
--------------------------------------------
// File: index.ts
// No top-level declarations found.

–§–∞–π–ª: frontend/src/context/SocketContext.tsx
--------------------------------------------
// File: SocketContext.tsx
// Summary of declarations:

export const SocketContext = createContext<Socket | null>(null);

–§–∞–π–ª: frontend/src/features/auth/authApi.ts
-------------------------------------------
// File: authApi.ts
// No top-level declarations found.

–§–∞–π–ª: frontend/src/features/auth/authSlice.ts
---------------------------------------------
// File: authSlice.ts
// Summary of declarations:

export interface AuthState {
  // ... implementation
}

const storedUserItem = localStorage.getItem('user');

const initialUser: User | null = storedUserItem ? JSON.parse(storedUserItem) : null;

const storedToken = localStorage.getItem('token');

export const { logout, setUser } = authSlice.actions;

export const selectCurrentUser = (state: RootState) => state.auth.user;

export const selectCurrentToken = (state: RootState) => state.auth.token;

export const selectIsAuthenticated = (state: RootState) => state.auth.isAuthenticated;

–§–∞–π–ª: frontend/src/features/chat/Chat.tsx
-----------------------------------------
// File: Chat.tsx
// Summary of declarations:

interface ChatUser {
  // ... implementation
}

–§–∞–π–ª: frontend/src/features/chat/chatApi.ts
-------------------------------------------
// File: chatApi.ts
// Summary of declarations:

type UnreadSummaryResponse = Record<string, number>;

export const { useGetUnreadSummaryQuery, useLazyGetUnreadSummaryQuery } = chatApi;

–§–∞–π–ª: frontend/src/features/chat/chatSlice.ts
---------------------------------------------
// File: chatSlice.ts
// Summary of declarations:

export interface ChatState {
  // ... implementation
}

const selectMessages = (state: RootState) => state.chat.messagesByPartnerId;

const selectActivePartnerId = (state: RootState) => state.chat.activeChatPartnerId;

–§–∞–π–ª: frontend/src/features/goal/goalApi.ts
-------------------------------------------
// File: goalApi.ts
// No top-level declarations found.

–§–∞–π–ª: frontend/src/features/lesson/lessonApi.ts
-----------------------------------------------
// File: lessonApi.ts
// Summary of declarations:

export interface GenerationResult {
  // ... implementation
}

–§–∞–π–ª: frontend/src/features/student/adventureSlice.ts
-----------------------------------------------------
// File: adventureSlice.ts
// Summary of declarations:

export interface AdventureState {
  // ... implementation
}

export const selectAdventure = (state: RootState) => state.adventure;

export const selectPracticeAnswers = (state: RootState) => state.adventure.practiceAnswers;

export const selectStoryResponse = (state: RootState) => state.adventure.storyResponse;

–§–∞–π–ª: frontend/src/features/student/studentApi.ts
-------------------------------------------------
// File: studentApi.ts
// Summary of declarations:

interface SubmitLessonApiPayload {
  // ... implementation
}

–§–∞–π–ª: frontend/src/features/teacher/StudentsPage.tsx
----------------------------------------------------
// File: StudentsPage.tsx
// Summary of declarations:

interface ConnectStudentForm {
  // ... implementation
}

–§–∞–π–ª: frontend/src/features/teacher/teacherApi.ts
-------------------------------------------------
// File: teacherApi.ts
// No top-level declarations found.

–§–∞–π–ª: frontend/src/i18n.ts
--------------------------
// File: i18n.ts
// Summary of declarations:

const savedLanguage = localStorage.getItem('i18nextLng') || 'ru';

–§–∞–π–ª: frontend/src/index.css
----------------------------
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --brand-600: #4f46e5; /* indigo-600 */
    --brand-500: #6366f1; /* indigo-500 */
    --brand-400: #818cf8; /* indigo-400 */


[... content truncated ...]

}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

–§–∞–π–ª: frontend/src/locales/en/translation.json
----------------------------------------------
{
  "studentDashboard": {
    "loadingError": "Error loading data. Please try again later.",
    "welcome": "Welcome, {{name}}!",
    "student": "Student",
    "quickAccess": "Quick Access",
    "continueAdventure": "Continue Adventure",
    "returnToLastLesson": "Return to the last lesson",
    "chatWithTeacher": "Chat with Teacher",
    "askQuestion": "Ask a question or get help",

[... content truncated ...]

  },
  "common": {
    "notImplemented": "This feature is not implemented yet."
  }
}

–§–∞–π–ª: frontend/src/locales/ru/translation.json
----------------------------------------------
{
  "studentDashboard": {
    "loadingError": "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
    "welcome": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{name}}!",
    "student": "–°—Ç—É–¥–µ–Ω—Ç",
    "quickAccess": "–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø",
    "continueAdventure": "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ",
    "returnToLastLesson": "–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —É—Ä–æ–∫—É",
    "chatWithTeacher": "–ß–∞—Ç —Å —É—á–∏—Ç–µ–ª–µ–º",
    "askQuestion": "–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –ø–æ–º–æ—â—å",

[... content truncated ...]

    "registerSuccess": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º...",
    "registerFailedDefault": "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑."
  }
  
}

–§–∞–π–ª: frontend/src/main.tsx
---------------------------
// File: main.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/HomePage.tsx
-------------------------------------
// File: HomePage.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/LoginPage.tsx
--------------------------------------
// File: LoginPage.tsx
// Summary of declarations:

type LoginFormData = z.infer<typeof loginSchema>;

–§–∞–π–ª: frontend/src/pages/NotFoundPage.tsx
-----------------------------------------
// File: NotFoundPage.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/RegisterPage.tsx
-----------------------------------------
// File: RegisterPage.tsx
// Summary of declarations:

type RegisterFormData = z.infer<typeof registerSchema>;

–§–∞–π–ª: frontend/src/pages/chat/ChatPage.tsx
------------------------------------------
// File: ChatPage.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/student/CompletedLessonsPage.tsx
---------------------------------------------------------
// File: CompletedLessonsPage.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/student/StoryHistoryPage.tsx
-----------------------------------------------------
// File: StoryHistoryPage.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/student/StudentAdventurePage.tsx
---------------------------------------------------------
// File: StudentAdventurePage.tsx
// Summary of declarations:

const SummaryModal = ({ isOpen, onClose, summary, isLoading }: { isOpen: boolean;

type LessonPhase = 'content' | 'assessment' | 'story' | 'control_work';

type ChatMessage = { role: 'user' | 'assistant', content: string };

–§–∞–π–ª: frontend/src/pages/student/StudentDashboard.tsx
-----------------------------------------------------
// File: StudentDashboard.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/student/StudentStoriesListPage.tsx
-----------------------------------------------------------
// File: StudentStoriesListPage.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/teacher/CreateGoalPage.tsx
---------------------------------------------------
// File: CreateGoalPage.tsx
// Summary of declarations:

interface CreateGoalFormData {
  // ... implementation
}

–§–∞–π–ª: frontend/src/pages/teacher/LearningGoalsListPage.tsx
----------------------------------------------------------
// File: LearningGoalsListPage.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/teacher/LessonEditorModal.tsx
------------------------------------------------------
// File: LessonEditorModal.tsx
// Summary of declarations:

const Lightbox = ({ src, onClose }: { src: string;

function classNames(...classes: (string | boolean)[]) {
  // ... implementation
}

–§–∞–π–ª: frontend/src/pages/teacher/RoadmapEditorPage.tsx
------------------------------------------------------
// File: RoadmapEditorPage.tsx
// Summary of declarations:

interface PerformanceLog {
  // ... implementation
}

interface ChatMessage {
  // ... implementation
}

interface RoadmapEditorContext {
  // ... implementation
}

–§–∞–π–ª: frontend/src/pages/teacher/TeacherDashboard.tsx
-----------------------------------------------------
// File: TeacherDashboard.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/teacher/components/CharacterEditor.tsx
---------------------------------------------------------------
// File: CharacterEditor.tsx
// Summary of declarations:

interface CharacterEditorProps {
  // ... implementation
}

const Lightbox = ({ src, onClose }: { src: string;

–§–∞–π–ª: frontend/src/pages/teacher/components/ControlWorkContentEditor.tsx
------------------------------------------------------------------------
// File: ControlWorkContentEditor.tsx
// Summary of declarations:

interface LessonContentBlock {
  // ... implementation
}

interface ChatMessage {
  // ... implementation
}

interface ControlWorkContentEditorProps {
  // ... implementation
}

–§–∞–π–ª: frontend/src/pages/teacher/components/LessonContentEditor.tsx
-------------------------------------------------------------------
// File: LessonContentEditor.tsx
// Summary of declarations:

interface LessonContentBlock {
  // ... implementation
}

interface ChatMessage {
  // ... implementation
}

interface LessonContentEditorProps {
  // ... implementation
}

–§–∞–π–ª: frontend/src/pages/teacher/components/LessonStatusIndicator.tsx
---------------------------------------------------------------------
// File: LessonStatusIndicator.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/teacher/components/LessonStoryEditor.tsx
-----------------------------------------------------------------
// File: LessonStoryEditor.tsx
// Summary of declarations:

interface LessonStoryEditorProps {
  // ... implementation
}

–§–∞–π–ª: frontend/src/pages/teacher/components/RoadmapSection.tsx
--------------------------------------------------------------
// File: RoadmapSection.tsx
// Summary of declarations:

interface RoadmapSectionProps {
  // ... implementation
}

function classNames(...classes: (string | boolean | undefined)[]) {
  // ... implementation
}

–§–∞–π–ª: frontend/src/types/models.ts
----------------------------------
// File: models.ts
// Summary of declarations:

export type UserRole = 'student' | 'teacher';

export interface User {
  // ... implementation
}

export interface StudentInfo {
  // ... implementation
}

export interface StudentProfile extends User {
  // ... implementation
}

export interface LearningGoal {
  // ... implementation
}

export interface ContentSection {
  // ... implementation
}

export type LessonType = 'THEORY' | 'PRACTICE' | 'WITH_TEACHER' | 'CONTROL_WORK';

export interface Lesson {
  // ... implementation
}

export interface StoryChapter {
  // ... implementation
}

export interface StoryChapterHistory extends StoryChapter {
  // ... implementation
}

export interface PerformanceLog {
  // ... implementation
}

export interface RoadmapProposal {
  // ... implementation
}

export interface OldRoadmapProposal {
  // ... implementation
}

export interface SubmitLessonPayload {
  // ... implementation
}

export interface AIAssessmentResponse {
  // ... implementation
}

–§–∞–π–ª: frontend/src/types/websocket.ts
-------------------------------------
// File: websocket.ts
// Summary of declarations:

export interface StudentSubmittedLessonEvent {
  // ... implementation
}

export interface TeacherReviewedLessonEvent {
  // ... implementation
}

export interface StudentRequestedReviewEvent {
  // ... implementation
}

–§–∞–π–ª: frontend/src/vite-env.d.ts
--------------------------------
// File: vite-env.d.ts
// Summary of declarations:

interface ImportMetaEnv {
  // ... implementation
}

interface ImportMeta {
  // ... implementation
}

–§–∞–π–ª: frontend/tailwind.config.js
---------------------------------
// File: tailwind.config.js
// No top-level declarations found.

–§–∞–π–ª: frontend/tsconfig.json
----------------------------
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "noEmit": true,
    "moduleResolution": "node",
    "resolveJsonModule": true,

[... content truncated ...]

  },
  "include": ["src"],
  "exclude": ["node_modules", "dist"],
  "references": [{ "path": "./tsconfig.node.json" }]
}

–§–∞–π–ª: frontend/tsconfig.node.json
---------------------------------
{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "composite": true,
    "module": "esnext",
    "moduleResolution": "node",
    "target": "ESNext",
    "types": ["node"],
    "allowSyntheticDefaultImports": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "strict": true,
    "noEmit": false
  },
  "include": ["vite.config.ts", "plugins/spa-fallback.ts", "vite-spa-fallback.ts"],
  "exclude": ["node_modules", "dist", "**/*.test.ts"]
}


–§–∞–π–ª: frontend/vite.config.ts
-----------------------------
// File: vite.config.ts
// Summary of declarations:

const __filename = fileURLToPath(import.meta.url);

const __dirname = resolve(__filename, '..');

–§–∞–π–ª: package.json
------------------
{
  "name": "math-quest",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "dev": "concurrently \"npm run backend:dev\" \"npm run frontend:dev\"",
    "backend:dev": "cd backend && npm run dev",
    "frontend:dev": "cd frontend && npm run dev",
    "install:all": "npm install && cd backend && npm install && cd ../frontend && npm install",
    "build": "cd backend && npm run build && cd ../frontend && npm run build",

[... content truncated ...]

  },
  "prisma": {
    "schema": "backend/prisma/schema.prisma"
  }
}
--- –ö–û–ù–ï–¶ –ö–û–ù–¢–ï–ö–°–¢–ê ---

--- –ó–ê–î–ê–ß–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ---
–ù–∞—É—á–∏ –º–µ–Ω—è –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç, –∫–∞–∂–µ—Ç—Å—è —Ç–∞–º –±—ã–ª —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞, –∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å —á—Ç–æ–±—ã –≤—Å–µ —Ä–∞–±–æ—Ç–∞–ª–æ, –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –∏ –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±
--- –ö–û–ù–ï–¶ –ó–ê–î–ê–ß–ò ---

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∑–∞–¥–∞—á—É –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç. –°–ª–µ–¥—É–π –ø—Ä–∞–≤–∏–ª–∞–º —ç—Ç–∞–ø–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.


================================================================================
–û–¢–í–ï–¢ (–°–æ—Å—Ç–æ—è–Ω–∏–µ: PLANNING, –ò—Ç–µ—Ä–∞—Ü–∏—è: 0)
--------------------------------------------------------------------------------
```plan
–ó–∞–¥–∞—á–∞ –ø–æ–Ω—è—Ç–Ω–∞. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç —É–∑–Ω–∞—Ç—å, –∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç. –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± ‚Äî —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `README.md` —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –∑–∞–ø—É—Å–∫—É. –≠—Ç–æ –±—É–¥–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –¥—Ä—É–≥–∏—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.

**–ü–ª–∞–Ω:**

1.  –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `README.md` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.
2.  –î–æ–±–∞–≤–∏—Ç—å –≤ `README.md` –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤–∫–ª—é—á–∞—é—Ç:
    *   –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ (Node.js, npm, PostgreSQL).
    *   –ü–æ—Ä—è–¥–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã `npm run install:all` –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.
    *   –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Ñ–∞–π–ª–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è `.env` –¥–ª—è –±—ç–∫–µ–Ω–¥–∞.
    *   –ö–æ–º–∞–Ω–¥—É –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: `npm run prisma:migrate`.
    *   –û—Å–Ω–æ–≤–Ω—É—é –∫–æ–º–∞–Ω–¥—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: `npm run dev`.

–¶–µ–ª—å ‚Äî –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –µ–¥–∏–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –æ–Ω —Å–º–æ–∂–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞.
```
```files
README.md
```

================================================================================
–ó–ê–ü–†–û–° (–°–æ—Å—Ç–æ—è–Ω–∏–µ: EXECUTION, –ò—Ç–µ—Ä–∞—Ü–∏—è: 1)
--------------------------------------------------------------------------------

–¢—ã ‚Äî AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

**–ü–†–ê–í–ò–õ–ê –≠–¢–ê–ü–ê –ò–°–ü–û–õ–ù–ï–ù–ò–Ø:**

1.  **–ü–†–ê–í–ò–õ–û ‚Ññ1: –¢–û–õ–¨–ö–û `write_file`**
    *   –î–ª—è **—Å–æ–∑–¥–∞–Ω–∏—è –ù–û–í–´–•** –∏–ª–∏ **–∏–∑–º–µ–Ω–µ–Ω–∏—è –°–£–©–ï–°–¢–í–£–Æ–©–ò–•** —Ñ–∞–π–ª–æ–≤ —Ç—ã **–û–ë–Ø–ó–ê–ù** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **—Ç–æ–ª—å–∫–æ** –±–ª–æ–∫ ```write_file```.
    *   –≠—Ç–æ—Ç –±–ª–æ–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∞–π–ª.

2.  **–ü–†–ê–í–ò–õ–û ‚Ññ2: –ü–û–õ–ù–û–¢–ê –ö–û–î–ê (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!)**
    *   –í–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ ```write_file``` —Ç—ã –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å **–ü–û–õ–ù–û–ï –°–û–î–ï–†–ñ–ò–ú–û–ï** —Ñ–∞–π–ª–∞ –æ—Ç –ø–µ—Ä–≤–æ–π –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ—á–∫–∏.
    *   **–ö–ê–¢–ï–ì–û–†–ò–ß–ï–°–ö–ò –ó–ê–ü–†–ï–©–ï–ù–û** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã, –º–Ω–æ–≥–æ—Ç–æ—á–∏—è (`...`), –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (`// ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥`) –∏–ª–∏ –ª—é–±—ã–µ –¥—Ä—É–≥–∏–µ —Å–ø–æ—Å–æ–±—ã —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è –∫–æ–¥–∞.

3.  **–§–æ—Ä–º–∞—Ç –û—Ç–≤–µ—Ç–∞:**
    *   **–î–µ–π—Å—Ç–≤–∏—è:** –¢–≤–æ–π –æ—Ç–≤–µ—Ç **–û–ë–Ø–ó–ê–ù** —Å–æ–¥–µ—Ä–∂–∞—Ç—å –û–î–ò–ù –∏–∑ –±–ª–æ–∫–æ–≤ –¥–µ–π—Å—Ç–≤–∏–π –∏ –°–†–ê–ó–£ –ü–û–°–õ–ï –Ω–µ–≥–æ –±–ª–æ–∫ `summary`:
        1.  **–î–ª—è –∫–æ–º–∞–Ω–¥ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞:** ```bash ... ```.
        2.  **–î–ª—è –°–û–ó–î–ê–ù–ò–Ø/–ò–ó–ú–ï–ù–ï–ù–ò–Ø —Ñ–∞–π–ª–∞:** ```write_file path/to/file.py ... ```.
    *   **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ:** –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ —Ä–µ—à–µ–Ω–∞, –Ω–∞–ø–∏—à–∏ **—Ç–æ–ª—å–∫–æ** `–ì–û–¢–û–í–û`, –∑–∞—Ç–µ–º –±–ª–æ–∫ ```done_summary ... ```. –î–ª—è —Ä—É—á–Ω—ã—Ö —à–∞–≥–æ–≤ –¥–æ–±–∞–≤—å –±–ª–æ–∫ ```manual```.


**–ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–†–ê–í–ò–õ–ê (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´ –ö –ò–°–ü–û–õ–ù–ï–ù–ò–Æ):**

1.  **–ü–†–ê–í–ò–õ–û –ü–£–¢–ï–ô (–°–ê–ú–û–ï –í–ê–ñ–ù–û–ï!):**
    *   –í—Å–µ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å (–≤ –±–ª–æ–∫–∞—Ö `files`, `write_file`, `bash`), –î–û–õ–ñ–ù–´ –±—ã—Ç—å **–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º–∏ –æ—Ç –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞**.
    *   **–ö–ê–¢–ï–ì–û–†–ò–ß–ï–°–ö–ò –ó–ê–ü–†–ï–©–ï–ù–û** –Ω–∞—á–∏–Ω–∞—Ç—å –ø—É—Ç—å —Å –∏–º–µ–Ω–∏ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞.
    *   **–ü—Ä–∏–º–µ—Ä:** –ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ `/path/to/my-project`, –∏ —Ç–µ–±–µ –Ω—É–∂–µ–Ω —Ñ–∞–π–ª `src/app.js`:
        *   **–ü–†–ê–í–ò–õ–¨–ù–û:** `src/app.js`
        *   **–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:** `my-project/src/app.js`

2.  **–†–∞–±–æ—á–∞—è –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:** –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∏–∑ **–∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞**. **–ó–ê–ü–†–ï–©–ï–ù–û** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `cd`.

3.  **–†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –ö–æ–º–∞–Ω–¥—ã:** `rm, mv, touch, mkdir, npm, npx, yarn, pnpm, git, echo, ./`. –ö–æ–º–∞–Ω–¥—ã, –Ω–µ –≤—Ö–æ–¥—è—â–∏–µ –≤ —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫, –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–º–µ—â–µ–Ω—ã –≤ –±–ª–æ–∫ ```manual```.

4.  **–§–æ–∫—É—Å –∏ –ü—Ä–∞–≥–º–∞—Ç–∏–∑–º:** –¢–≤–æ—è –≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî —Ä–µ—à–∏—Ç—å **–∏—Å—Ö–æ–¥–Ω—É—é –∑–∞–¥–∞—á—É** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ù–µ –∑–∞–Ω–∏–º–∞–π—Å—è –ø–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏–∑–º–æ–º: –Ω–µ –∏—Å–ø—Ä–∞–≤–ª—è–π —Å—Ç–∏–ª—å –∫–æ–¥–∞ –∏ –Ω–µ –¥–µ–ª–∞–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –∑–∞–¥–∞—á–µ–π.


**–§–æ—Ä–º–∞—Ç write_file —Å BOUNDARY (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω):**
```write_file path="path/to/file" boundary="SLOTH_BOUNDARY_070162a1463b4766a0640e529949ed46"
<–ª—é–±–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Ñ–∞–π–ª–∞, –≤ —Ç.—á. —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ ```
 –∏ ```bash –±–ª–æ–∫–∞–º–∏>
SLOTH_BOUNDARY_070162a1463b4766a0640e529949ed46

–ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–æ–∫–∞ –ü–ï–†–ï–î –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º ``` ‚Äî —Ä–æ–≤–Ω–æ SLOTH_BOUNDARY_070162a1463b4766a0640e529949ed46.



--- –ö–û–ù–¢–ï–ö–°–¢ –ü–†–û–ï–ö–¢–ê (–ü–û–õ–ù–´–ô –ò–õ–ò –ß–ê–°–¢–ò–ß–ù–´–ô) ---
–°–µ–π—á–∞—Å —è –≤—ã–≥—Ä—É–∂—É –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞: —Å–Ω–∞—á–∞–ª–∞ –¥–µ—Ä–µ–≤–æ —Ñ–∞–π–ª–æ–≤ —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏ –≤ —Å–∏–º–≤–æ–ª–∞—Ö, –∞ –ø–æ—Ç–æ–º –∏—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ.

--- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ ---
tutor-game-new/
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.ts (2928 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ websocket.ts (739 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ context/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SocketContext.tsx (541 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ locales/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ru/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ translation.json (16998 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ en/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ translation.json (16324 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts (106 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useAppDispatch.ts (305 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useAppSelector.ts (185 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ apiSlice.ts (418 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ axiosBaseQuery.ts (1500 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ store.ts (801 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ features/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Chat.tsx (6539 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chatApi.ts (601 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ chatSlice.ts (2844 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authApi.ts (4588 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ authSlice.ts (3370 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ student/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ adventureSlice.ts (1773 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ studentApi.ts (3518 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lesson/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lessonApi.ts (4505 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ teacher/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StudentsPage.tsx (5798 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ teacherApi.ts (2085 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ goal/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ goalApi.ts (6184 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ common/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Layout.tsx (18081 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Spinner.tsx (645 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ WebSocketManager.tsx (7900 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ icons/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ index.ts (150 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ChatPage.tsx (933 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ student/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CompletedLessonsPage.tsx (5904 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StoryHistoryPage.tsx (4448 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ !!!StudentAdventurePage.tsx (27808 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StudentDashboard.tsx (4404 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ StudentStoriesListPage.tsx (2645 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ teacher/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CharacterEditor.tsx (8637 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ControlWorkContentEditor.tsx (7310 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LessonContentEditor.tsx (10291 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LessonStatusIndicator.tsx (1296 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LessonStoryEditor.tsx (11097 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RoadmapSection.tsx (12172 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CreateGoalPage.tsx (6966 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LearningGoalsListPage.tsx (3367 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LessonEditorModal.tsx (7587 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ !!!RoadmapEditorPage.tsx (19768 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TeacherDashboard.tsx (2032 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ HomePage.tsx (6282 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoginPage.tsx (6482 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotFoundPage.tsx (1517 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RegisterPage.tsx (10655 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.tsx (4010 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthInitializer.tsx (1937 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ i18n.ts (866 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.css (10114 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tsx (687 chars)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ vite-env.d.ts (204 chars)
‚îÇ   ‚îú‚îÄ‚îÄ index.html (1033 chars)
‚îÇ   ‚îú‚îÄ‚îÄ package.json (1303 chars)
‚îÇ   ‚îú‚îÄ‚îÄ postcss.config.js (80 chars)
‚îÇ   ‚îú‚îÄ‚îÄ tailwind.config.js (3081 chars)
‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json (793 chars)
‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.node.json (511 chars)
‚îÇ   ‚îî‚îÄ‚îÄ vite.config.ts (1373 chars)
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20250622134108_final_schema_update/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql (7197 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20250706111311_remove_obsolete_story_model/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql (339 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20250622202034_add_character_and_story_models/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql (1121 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20250708100000_add_illustration_style/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql (112 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20250623091331_add_image_prompt_to_story_chapter/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql (945 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20250622144309_add_language_to_goal/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql (102 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20250707120000_remove_badges/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql (153 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20250623153940_enhance_performance_log/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql (155 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20250623180646_make_log_fields_optional/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql (2078 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20250719195723_add_control_work_lesson_type/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql (63 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration_lock.toml (128 chars)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma (6235 chars)
‚îÇ   ‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ check-db.ts (817 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ createTestUsers.ts (4550 chars)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lowercase-emails.ts (2380 chars)
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ env.ts (2623 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middlewares/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.middleware.ts (1266 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ teacher.middleware.ts (937 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ errors.ts (1236 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fileUpload.ts (1807 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logger.ts (2445 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.ts (9772 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ character.controller.ts (6168 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat.controller.ts (905 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ goal.controller.ts (5466 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lesson.controller.ts (5886 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ performanceLogs.controller.ts (1519 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ roadmap.controller.ts (6124 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ story.controller.ts (13301 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ student.controller.ts (16801 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ teacher.controller.ts (3101 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.routes.ts (674 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ character.routes.ts (779 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat.routes.ts (452 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ goal.routes.ts (770 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ image.routes.ts (466 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lesson.routes.ts (715 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ roadmap.routes.ts (554 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ story.routes.ts (956 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ student.routes.ts (1482 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ teacher.routes.ts (951 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.service.ts (8499 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat.service.ts (1691 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ !!!gemini.service.ts (22583 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ leonardo.service.ts (6637 chars)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ websocket.service.ts (7143 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app.ts (4619 chars)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db.ts (895 chars)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts (912 chars)
‚îÇ   ‚îú‚îÄ‚îÄ .env (1473 chars)
‚îÇ   ‚îú‚îÄ‚îÄ .env.example (505 chars)
‚îÇ   ‚îú‚îÄ‚îÄ package.json (1430 chars)
‚îÇ   ‚îú‚îÄ‚îÄ start.sh (332 chars)
‚îÇ   ‚îî‚îÄ‚îÄ tsconfig.json (386 chars)
‚îú‚îÄ‚îÄ package.json (1191 chars)
‚îî‚îÄ‚îÄ sloth_plan.txt (871 chars)

--- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–æ–≤ ---

–§–∞–π–ª: backend/.env
------------------
[Content of file .env truncated. First 10 lines:]
# tutor-game/backend/.env

# --- Server Configuration ---
NODE_ENV=development
PORT=3002

# --- Database Configuration ---
# URL –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ç–≤–æ–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
DATABASE_URL="postgresql://vladimirdoronin@localhost:5432/tutor_game?schema=public"


–§–∞–π–ª: backend/.env.example
--------------------------
[Content of file .env.example truncated. First 10 lines:]
# Server Configuration
PORT=3001
NODE_ENV=development

# JWT Configuration
JWT_SECRET=your_jwt_secret_key_here
JWT_EXPIRES_IN=7d

# Database Configuration
DATABASE_URL=postgresql://username:password@localhost:5432/math_quest?schema=public

–§–∞–π–ª: backend/package.json
--------------------------
{
  "name": "backend",
  "version": "1.0.0",
  "main": "dist/index.js",
  "scripts": {
    "build": "tsc",
    "dev": "ts-node-dev --respawn --transpile-only src/index.ts",
    "start": "./start.sh",
    "prisma:generate": "prisma generate",
    "prisma:migrate": "prisma migrate dev",

[... content truncated ...]

    "prisma": "^6.8.2",
    "ts-node-dev": "^2.0.0",
    "typescript": "^5.0.0"
  }
}

–§–∞–π–ª: backend/prisma/migrations/20250622134108_final_schema_update/migration.sql
--------------------------------------------------------------------------------
[Content of file migration.sql truncated. First 10 lines:]
-- CreateEnum
CREATE TYPE "Role" AS ENUM ('STUDENT', 'TEACHER');

-- CreateEnum
CREATE TYPE "LessonType" AS ENUM ('THEORY', 'PRACTICE', 'WITH_TEACHER');

-- CreateEnum
CREATE TYPE "LessonStatus" AS ENUM ('DRAFT', 'PENDING_APPROVAL', 'APPROVED', 'COMPLETED');

-- CreateEnum

–§–∞–π–ª: backend/prisma/migrations/20250622144309_add_language_to_goal/migration.sql
---------------------------------------------------------------------------------
-- AlterTable
ALTER TABLE "learning_goals" ADD COLUMN     "language" TEXT NOT NULL DEFAULT 'Russian';


–§–∞–π–ª: backend/prisma/migrations/20250622202034_add_character_and_story_models/migration.sql
-------------------------------------------------------------------------------------------
[Content of file migration.sql truncated. First 10 lines:]
-- AlterTable
ALTER TABLE "learning_goals" ADD COLUMN     "characterGenId" TEXT,
ADD COLUMN     "characterImageId" TEXT,
ADD COLUMN     "characterImageUrl" TEXT,
ADD COLUMN     "characterPrompt" TEXT;

-- CreateTable
CREATE TABLE "story_chapters" (
    "id" TEXT NOT NULL,
    "learningGoalId" TEXT NOT NULL,

–§–∞–π–ª: backend/prisma/migrations/20250623091331_add_image_prompt_to_story_chapter/migration.sql
----------------------------------------------------------------------------------------------
/*
  Warnings:

  - You are about to drop the column `studentResponseText` on the `story_chapters` table. All the data in the column will be lost.
  - The `teacherSnippetStatus` column on the `story_chapters` table would be dropped and recreated. This will lead to data loss if there is data in the column.
  - Added the required column `updatedAt` to the `story_chapters` table without a default value. This is not possible if the table is not empty.

*/
-- AlterTable
ALTER TABLE "story_chapters" DROP COLUMN "studentResponseText",
ADD COLUMN     "studentSnippetImageUrl" TEXT,
ADD COLUMN     "studentSnippetStatus" TEXT NOT NULL DEFAULT 'LOCKED',
ADD COLUMN     "studentSnippetText" TEXT,
ADD COLUMN     "teacherSnippetImagePrompt" TEXT,
ADD COLUMN     "updatedAt" TIMESTAMP(3) NOT NULL,
ALTER COLUMN "teacherSnippetText" DROP NOT NULL,
DROP COLUMN "teacherSnippetStatus",
ADD COLUMN     "teacherSnippetStatus" TEXT NOT NULL DEFAULT 'DRAFT';


–§–∞–π–ª: backend/prisma/migrations/20250623153940_enhance_performance_log/migration.sql
------------------------------------------------------------------------------------
-- AlterTable
ALTER TABLE "student_performance_logs" ADD COLUMN     "blockIndex" INTEGER,
ADD COLUMN     "blockType" TEXT,
ADD COLUMN     "question" TEXT;


–§–∞–π–ª: backend/prisma/migrations/20250623180646_make_log_fields_optional/migration.sql
-------------------------------------------------------------------------------------
[Content of file migration.sql truncated. First 10 lines:]
/*
  Warnings:

  - You are about to drop the column `blockIndex` on the `student_performance_logs` table. All the data in the column will be lost.
  - You are about to drop the column `blockType` on the `student_performance_logs` table. All the data in the column will be lost.
  - You are about to drop the column `createdAt` on the `student_performance_logs` table. All the data in the column will be lost.
  - You are about to drop the column `lessonId` on the `student_performance_logs` table. All the data in the column will be lost.
  - You are about to drop the column `studentId` on the `student_performance_logs` table. All the data in the column will be lost.
  - Added the required column `lesson_id` to the `student_performance_logs` table without a default value. This is not possible if the table is not empty.
  - Added the required column `student_id` to the `student_performance_logs` table without a default value. This is not possible if the table is not empty.

–§–∞–π–ª: backend/prisma/migrations/20250706111311_remove_obsolete_story_model/migration.sql
----------------------------------------------------------------------------------------
/*
  Warnings:

  - You are about to drop the `stories` table. If the table is not empty, all the data it contains will be lost.

*/
-- DropForeignKey
ALTER TABLE "stories" DROP CONSTRAINT "stories_learningGoalId_fkey";

-- DropForeignKey
ALTER TABLE "stories" DROP CONSTRAINT "stories_studentId_fkey";

-- DropTable
DROP TABLE "stories";


–§–∞–π–ª: backend/prisma/migrations/20250707120000_remove_badges/migration.sql
--------------------------------------------------------------------------
-- DropForeignKey
ALTER TABLE "badges" DROP CONSTRAINT "badges_studentId_fkey";

-- DropTable
DROP TABLE "badges";

-- DropEnum
DROP TYPE "BadgeStatus";


–§–∞–π–ª: backend/prisma/migrations/20250708100000_add_illustration_style/migration.sql
-----------------------------------------------------------------------------------
-- AlterTable
ALTER TABLE "learning_goals" ADD COLUMN "illustrationStyle" TEXT NOT NULL DEFAULT 'ILLUSTRATION';


–§–∞–π–ª: backend/prisma/migrations/20250719195723_add_control_work_lesson_type/migration.sql
-----------------------------------------------------------------------------------------
-- AlterEnum
ALTER TYPE "LessonType" ADD VALUE 'CONTROL_WORK';


–§–∞–π–ª: backend/prisma/migrations/migration_lock.toml
---------------------------------------------------
# Please do not edit this file manually
# It should be added in your version-control system (e.g., Git)
provider = "postgresql"


–§–∞–π–ª: backend/prisma/schema.prisma
----------------------------------
[Content of file schema.prisma truncated. First 10 lines:]
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")

–§–∞–π–ª: backend/scripts/check-db.ts
---------------------------------
// File: check-db.ts
// Summary of declarations:

async function checkDatabase() {
  // ... implementation
}

–§–∞–π–ª: backend/scripts/createTestUsers.ts
----------------------------------------
// File: createTestUsers.ts
// Summary of declarations:

const prisma = new PrismaClient();

async function main() {
  // ... implementation
}

–§–∞–π–ª: backend/scripts/lowercase-emails.ts
-----------------------------------------
// File: lowercase-emails.ts
// Summary of declarations:

const prisma = new PrismaClient();

async function lowercaseEmails() {
  // ... implementation
}

–§–∞–π–ª: backend/src/app.ts
------------------------
// File: app.ts
// Summary of declarations:

interface ServerWithWebSocket extends http.Server {
  // ... implementation
}

–§–∞–π–ª: backend/src/config/env.ts
-------------------------------
// File: env.ts
// Summary of declarations:

const envVars = envSchema.safeParse(process.env);

export type Config = typeof config;

–§–∞–π–ª: backend/src/controllers/auth.controller.ts
------------------------------------------------
// File: auth.controller.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/controllers/character.controller.ts
-----------------------------------------------------
// File: character.controller.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/controllers/chat.controller.ts
------------------------------------------------
// File: chat.controller.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/controllers/goal.controller.ts
------------------------------------------------
// File: goal.controller.ts
// Summary of declarations:

interface CreateGoalBody {
  // ... implementation
}

–§–∞–π–ª: backend/src/controllers/lesson.controller.ts
--------------------------------------------------
// File: lesson.controller.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/controllers/performanceLogs.controller.ts
-----------------------------------------------------------
// File: performanceLogs.controller.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/controllers/roadmap.controller.ts
---------------------------------------------------
// File: roadmap.controller.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/controllers/story.controller.ts
-------------------------------------------------
// File: story.controller.ts
// Summary of declarations:

interface Request extends ExpressRequest {
  // ... implementation
}

–§–∞–π–ª: backend/src/controllers/student.controller.ts
---------------------------------------------------
// File: student.controller.ts
// Summary of declarations:

interface Request extends ExpressRequest {
  // ... implementation
}

–§–∞–π–ª: backend/src/controllers/teacher.controller.ts
---------------------------------------------------
// File: teacher.controller.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/db.ts
-----------------------
// File: db.ts
// Summary of declarations:

const prisma = global.prisma || new PrismaClient(prismaOptions);

–§–∞–π–ª: backend/src/index.ts
--------------------------
// File: index.ts
// Summary of declarations:

const PORT = process.env.PORT || '3002';

const { server } = createServer();

–§–∞–π–ª: backend/src/middlewares/auth.middleware.ts
------------------------------------------------
// File: auth.middleware.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/middlewares/teacher.middleware.ts
---------------------------------------------------
// File: teacher.middleware.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/routes/auth.routes.ts
---------------------------------------
// File: auth.routes.ts
// Summary of declarations:

const router = Router();

–§–∞–π–ª: backend/src/routes/character.routes.ts
--------------------------------------------
// File: character.routes.ts
// Summary of declarations:

const router = Router();

–§–∞–π–ª: backend/src/routes/chat.routes.ts
---------------------------------------
// File: chat.routes.ts
// Summary of declarations:

const router = Router();

–§–∞–π–ª: backend/src/routes/goal.routes.ts
---------------------------------------
// File: goal.routes.ts
// Summary of declarations:

const router = Router();

–§–∞–π–ª: backend/src/routes/image.routes.ts
----------------------------------------
// File: image.routes.ts
// Summary of declarations:

const router = Router();

–§–∞–π–ª: backend/src/routes/lesson.routes.ts
-----------------------------------------
// File: lesson.routes.ts
// Summary of declarations:

const router = Router();

–§–∞–π–ª: backend/src/routes/roadmap.routes.ts
------------------------------------------
// File: roadmap.routes.ts
// Summary of declarations:

const router = Router();

–§–∞–π–ª: backend/src/routes/story.routes.ts
----------------------------------------
// File: story.routes.ts
// Summary of declarations:

const router = Router();

–§–∞–π–ª: backend/src/routes/student.routes.ts
------------------------------------------
// File: student.routes.ts
// Summary of declarations:

const router = Router();

–§–∞–π–ª: backend/src/routes/teacher.routes.ts
------------------------------------------
// File: teacher.routes.ts
// Summary of declarations:

const router = Router();

–§–∞–π–ª: backend/src/services/auth.service.ts
------------------------------------------
// File: auth.service.ts
// Summary of declarations:

interface SafeUser {
  // ... implementation
}

type PrismaType = typeof Prisma;

interface TokenPayload {
  // ... implementation
}

interface AuthResponse {
  // ... implementation
}

const loginAttempts = new Map<string, { count: number;

export const login = async (email: string, password: string, ipAddress: string): Promise<{ user: SafeUser;

–§–∞–π–ª: backend/src/services/chat.service.ts
------------------------------------------
// File: chat.service.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/services/gemini.service.ts
--------------------------------------------
// File: gemini.service.ts
// Summary of declarations:

const genAI = new GoogleGenerativeAI(config.geminiApiKey);

const MODEL_NAME = "gemini-2.5-flash";

const TEMP_LOW = 0.2;

const TEMP_MID = 0.45;

const TEMP_HIGH = 0.85;

function createGeminiHistory(systemPrompt: string, chatHistory: {
  // ... implementation
}

async function callGemini(prompt: string, temperature: number, isJson: boolean) {
  // ... implementation
}

async function callGeminiWithChat(history: Content[], temperature: number, isJson: boolean) {
  // ... implementation
}

–§–∞–π–ª: backend/src/services/leonardo.service.ts
----------------------------------------------
// File: leonardo.service.ts
// Summary of declarations:

const LEONARDO_API_URL = 'https://cloud.leonardo.ai/api/rest/v1';

export interface GenerateImageParams {
  // ... implementation
}

export interface GenerationResult {
  // ... implementation
}

export async function startImageGeneration(params: GenerateImageParams): Promise<{
  // ... implementation
}

export async function uploadImageToLeonardo(filePath: string): Promise<{
  // ... implementation
}

export async function getGenerationResult(generationId: string): Promise<GenerationResult> {
  // ... implementation
}

export async function generateImage(params: GenerateImageParams): Promise<GenerationResult> {
  // ... implementation
}

–§–∞–π–ª: backend/src/services/websocket.service.ts
-----------------------------------------------
// File: websocket.service.ts
// Summary of declarations:

interface AuthenticatedSocket extends Socket {
  // ... implementation
}

export class WebSocketService {
  // ... implementation
}

–§–∞–π–ª: backend/src/utils/errors.ts
---------------------------------
// File: errors.ts
// Summary of declarations:

export class AppError extends Error {
  // ... implementation
}

–§–∞–π–ª: backend/src/utils/fileUpload.ts
-------------------------------------
// File: fileUpload.ts
// No top-level declarations found.

–§–∞–π–ª: backend/src/utils/logger.ts
---------------------------------
// File: logger.ts
// Summary of declarations:

const { combine, timestamp, printf, colorize, errors } = format;

–§–∞–π–ª: backend/start.sh
----------------------
#!/bin/sh
# This script ensures the server restarts automatically after a crash.

while true; do
  echo "[Auto-Restart] Starting Node.js server..."
  # We run the command that directly starts the node process
  node dist/index.js
  echo "[Auto-Restart] Server process exited with code $?. Restarting in 3 seconds..."
  sleep 3
done


–§–∞–π–ª: backend/tsconfig.json
---------------------------
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "moduleResolution": "node",
    "resolveJsonModule": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "**/*.test.ts"]
}


–§–∞–π–ª: frontend/index.html
-------------------------
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#4f46e5" />
    <title>Math Quest</title>
    <base href="/" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

[... content truncated ...]

        }
      });
    </script>
  </body>
</html>

–§–∞–π–ª: frontend/package.json
---------------------------
{
  "name": "frontend",
  "private": true,
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "preview": "vite preview"

[... content truncated ...]

    "tailwindcss": "^3.4.1",
    "typescript": "^5.4.2",
    "vite": "^5.1.6"
  }
}

–§–∞–π–ª: frontend/postcss.config.js
--------------------------------
// File: postcss.config.js
// No top-level declarations found.

–§–∞–π–ª: frontend/src/App.tsx
--------------------------
// File: App.tsx
// Summary of declarations:

function App() {
  // ... implementation
}

–§–∞–π–ª: frontend/src/AuthInitializer.tsx
--------------------------------------
// File: AuthInitializer.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/app/api/apiSlice.ts
--------------------------------------
// File: apiSlice.ts
// No top-level declarations found.

–§–∞–π–ª: frontend/src/app/api/axiosBaseQuery.ts
--------------------------------------------
// File: axiosBaseQuery.ts
// No top-level declarations found.

–§–∞–π–ª: frontend/src/app/hooks/index.ts
-------------------------------------
// File: index.ts
// No top-level declarations found.

–§–∞–π–ª: frontend/src/app/hooks/useAppDispatch.ts
----------------------------------------------
// File: useAppDispatch.ts
// Summary of declarations:

type TypedDispatch = ThunkDispatch<RootState, unknown, UnknownAction>;

export const useAppDispatch = (): TypedDispatch => useDispatch<TypedDispatch>();

–§–∞–π–ª: frontend/src/app/hooks/useAppSelector.ts
----------------------------------------------
// File: useAppSelector.ts
// Summary of declarations:

export const useAppSelector: TypedUseSelectorHook<RootState> = useSelector;

–§–∞–π–ª: frontend/src/app/store.ts
-------------------------------
// File: store.ts
// Summary of declarations:

export type RootState = ReturnType<typeof store.getState>;

export type AppDispatch = typeof store.dispatch;

–§–∞–π–ª: frontend/src/components/common/Layout.tsx
-----------------------------------------------
// File: Layout.tsx
// Summary of declarations:

interface NavigationItem {
  // ... implementation
}

function getStudentNavigation(t: (key: string) => string): NavigationItem[] {
  // ... implementation
}

function getTeacherNavigation(t: (key: string) => string): NavigationItem[] {
  // ... implementation
}

function classNames(...classes: (string | boolean | undefined)[]): string {
  // ... implementation
}

–§–∞–π–ª: frontend/src/components/common/Spinner.tsx
------------------------------------------------
// File: Spinner.tsx
// Summary of declarations:

type SpinnerSize = 'sm' | 'md' | 'lg';

interface SpinnerProps {
  // ... implementation
}

–§–∞–π–ª: frontend/src/components/common/WebSocketManager.tsx
---------------------------------------------------------
// File: WebSocketManager.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/components/icons/index.ts
--------------------------------------------
// File: index.ts
// No top-level declarations found.

–§–∞–π–ª: frontend/src/context/SocketContext.tsx
--------------------------------------------
// File: SocketContext.tsx
// Summary of declarations:

export const SocketContext = createContext<Socket | null>(null);

–§–∞–π–ª: frontend/src/features/auth/authApi.ts
-------------------------------------------
// File: authApi.ts
// No top-level declarations found.

–§–∞–π–ª: frontend/src/features/auth/authSlice.ts
---------------------------------------------
// File: authSlice.ts
// Summary of declarations:

export interface AuthState {
  // ... implementation
}

const storedUserItem = localStorage.getItem('user');

const initialUser: User | null = storedUserItem ? JSON.parse(storedUserItem) : null;

const storedToken = localStorage.getItem('token');

export const { logout, setUser } = authSlice.actions;

export const selectCurrentUser = (state: RootState) => state.auth.user;

export const selectCurrentToken = (state: RootState) => state.auth.token;

export const selectIsAuthenticated = (state: RootState) => state.auth.isAuthenticated;

–§–∞–π–ª: frontend/src/features/chat/Chat.tsx
-----------------------------------------
// File: Chat.tsx
// Summary of declarations:

interface ChatUser {
  // ... implementation
}

–§–∞–π–ª: frontend/src/features/chat/chatApi.ts
-------------------------------------------
// File: chatApi.ts
// Summary of declarations:

type UnreadSummaryResponse = Record<string, number>;

export const { useGetUnreadSummaryQuery, useLazyGetUnreadSummaryQuery } = chatApi;

–§–∞–π–ª: frontend/src/features/chat/chatSlice.ts
---------------------------------------------
// File: chatSlice.ts
// Summary of declarations:

export interface ChatState {
  // ... implementation
}

const selectMessages = (state: RootState) => state.chat.messagesByPartnerId;

const selectActivePartnerId = (state: RootState) => state.chat.activeChatPartnerId;

–§–∞–π–ª: frontend/src/features/goal/goalApi.ts
-------------------------------------------
// File: goalApi.ts
// No top-level declarations found.

–§–∞–π–ª: frontend/src/features/lesson/lessonApi.ts
-----------------------------------------------
// File: lessonApi.ts
// Summary of declarations:

export interface GenerationResult {
  // ... implementation
}

–§–∞–π–ª: frontend/src/features/student/adventureSlice.ts
-----------------------------------------------------
// File: adventureSlice.ts
// Summary of declarations:

export interface AdventureState {
  // ... implementation
}

export const selectAdventure = (state: RootState) => state.adventure;

export const selectPracticeAnswers = (state: RootState) => state.adventure.practiceAnswers;

export const selectStoryResponse = (state: RootState) => state.adventure.storyResponse;

–§–∞–π–ª: frontend/src/features/student/studentApi.ts
-------------------------------------------------
// File: studentApi.ts
// Summary of declarations:

interface SubmitLessonApiPayload {
  // ... implementation
}

–§–∞–π–ª: frontend/src/features/teacher/StudentsPage.tsx
----------------------------------------------------
// File: StudentsPage.tsx
// Summary of declarations:

interface ConnectStudentForm {
  // ... implementation
}

–§–∞–π–ª: frontend/src/features/teacher/teacherApi.ts
-------------------------------------------------
// File: teacherApi.ts
// No top-level declarations found.

–§–∞–π–ª: frontend/src/i18n.ts
--------------------------
// File: i18n.ts
// Summary of declarations:

const savedLanguage = localStorage.getItem('i18nextLng') || 'ru';

–§–∞–π–ª: frontend/src/index.css
----------------------------
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --brand-600: #4f46e5; /* indigo-600 */
    --brand-500: #6366f1; /* indigo-500 */
    --brand-400: #818cf8; /* indigo-400 */


[... content truncated ...]

}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

–§–∞–π–ª: frontend/src/locales/en/translation.json
----------------------------------------------
{
  "studentDashboard": {
    "loadingError": "Error loading data. Please try again later.",
    "welcome": "Welcome, {{name}}!",
    "student": "Student",
    "quickAccess": "Quick Access",
    "continueAdventure": "Continue Adventure",
    "returnToLastLesson": "Return to the last lesson",
    "chatWithTeacher": "Chat with Teacher",
    "askQuestion": "Ask a question or get help",

[... content truncated ...]

  },
  "common": {
    "notImplemented": "This feature is not implemented yet."
  }
}

–§–∞–π–ª: frontend/src/locales/ru/translation.json
----------------------------------------------
{
  "studentDashboard": {
    "loadingError": "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
    "welcome": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{name}}!",
    "student": "–°—Ç—É–¥–µ–Ω—Ç",
    "quickAccess": "–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø",
    "continueAdventure": "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ",
    "returnToLastLesson": "–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —É—Ä–æ–∫—É",
    "chatWithTeacher": "–ß–∞—Ç —Å —É—á–∏—Ç–µ–ª–µ–º",
    "askQuestion": "–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –ø–æ–º–æ—â—å",

[... content truncated ...]

    "registerSuccess": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º...",
    "registerFailedDefault": "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑."
  }
  
}

–§–∞–π–ª: frontend/src/main.tsx
---------------------------
// File: main.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/HomePage.tsx
-------------------------------------
// File: HomePage.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/LoginPage.tsx
--------------------------------------
// File: LoginPage.tsx
// Summary of declarations:

type LoginFormData = z.infer<typeof loginSchema>;

–§–∞–π–ª: frontend/src/pages/NotFoundPage.tsx
-----------------------------------------
// File: NotFoundPage.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/RegisterPage.tsx
-----------------------------------------
// File: RegisterPage.tsx
// Summary of declarations:

type RegisterFormData = z.infer<typeof registerSchema>;

–§–∞–π–ª: frontend/src/pages/chat/ChatPage.tsx
------------------------------------------
// File: ChatPage.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/student/CompletedLessonsPage.tsx
---------------------------------------------------------
// File: CompletedLessonsPage.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/student/StoryHistoryPage.tsx
-----------------------------------------------------
// File: StoryHistoryPage.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/student/StudentAdventurePage.tsx
---------------------------------------------------------
// File: StudentAdventurePage.tsx
// Summary of declarations:

const SummaryModal = ({ isOpen, onClose, summary, isLoading }: { isOpen: boolean;

type LessonPhase = 'content' | 'assessment' | 'story' | 'control_work';

type ChatMessage = { role: 'user' | 'assistant', content: string };

–§–∞–π–ª: frontend/src/pages/student/StudentDashboard.tsx
-----------------------------------------------------
// File: StudentDashboard.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/student/StudentStoriesListPage.tsx
-----------------------------------------------------------
// File: StudentStoriesListPage.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/teacher/CreateGoalPage.tsx
---------------------------------------------------
// File: CreateGoalPage.tsx
// Summary of declarations:

interface CreateGoalFormData {
  // ... implementation
}

–§–∞–π–ª: frontend/src/pages/teacher/LearningGoalsListPage.tsx
----------------------------------------------------------
// File: LearningGoalsListPage.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/teacher/LessonEditorModal.tsx
------------------------------------------------------
// File: LessonEditorModal.tsx
// Summary of declarations:

const Lightbox = ({ src, onClose }: { src: string;

function classNames(...classes: (string | boolean)[]) {
  // ... implementation
}

–§–∞–π–ª: frontend/src/pages/teacher/RoadmapEditorPage.tsx
------------------------------------------------------
// File: RoadmapEditorPage.tsx
// Summary of declarations:

interface PerformanceLog {
  // ... implementation
}

interface ChatMessage {
  // ... implementation
}

interface RoadmapEditorContext {
  // ... implementation
}

–§–∞–π–ª: frontend/src/pages/teacher/TeacherDashboard.tsx
-----------------------------------------------------
// File: TeacherDashboard.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/teacher/components/CharacterEditor.tsx
---------------------------------------------------------------
// File: CharacterEditor.tsx
// Summary of declarations:

interface CharacterEditorProps {
  // ... implementation
}

const Lightbox = ({ src, onClose }: { src: string;

–§–∞–π–ª: frontend/src/pages/teacher/components/ControlWorkContentEditor.tsx
------------------------------------------------------------------------
// File: ControlWorkContentEditor.tsx
// Summary of declarations:

interface LessonContentBlock {
  // ... implementation
}

interface ChatMessage {
  // ... implementation
}

interface ControlWorkContentEditorProps {
  // ... implementation
}

–§–∞–π–ª: frontend/src/pages/teacher/components/LessonContentEditor.tsx
-------------------------------------------------------------------
// File: LessonContentEditor.tsx
// Summary of declarations:

interface LessonContentBlock {
  // ... implementation
}

interface ChatMessage {
  // ... implementation
}

interface LessonContentEditorProps {
  // ... implementation
}

–§–∞–π–ª: frontend/src/pages/teacher/components/LessonStatusIndicator.tsx
---------------------------------------------------------------------
// File: LessonStatusIndicator.tsx
// No top-level declarations found.

–§–∞–π–ª: frontend/src/pages/teacher/components/LessonStoryEditor.tsx
-----------------------------------------------------------------
// File: LessonStoryEditor.tsx
// Summary of declarations:

interface LessonStoryEditorProps {
  // ... implementation
}

–§–∞–π–ª: frontend/src/pages/teacher/components/RoadmapSection.tsx
--------------------------------------------------------------
// File: RoadmapSection.tsx
// Summary of declarations:

interface RoadmapSectionProps {
  // ... implementation
}

function classNames(...classes: (string | boolean | undefined)[]) {
  // ... implementation
}

–§–∞–π–ª: frontend/src/types/models.ts
----------------------------------
// File: models.ts
// Summary of declarations:

export type UserRole = 'student' | 'teacher';

export interface User {
  // ... implementation
}

export interface StudentInfo {
  // ... implementation
}

export interface StudentProfile extends User {
  // ... implementation
}

export interface LearningGoal {
  // ... implementation
}

export interface ContentSection {
  // ... implementation
}

export type LessonType = 'THEORY' | 'PRACTICE' | 'WITH_TEACHER' | 'CONTROL_WORK';

export interface Lesson {
  // ... implementation
}

export interface StoryChapter {
  // ... implementation
}

export interface StoryChapterHistory extends StoryChapter {
  // ... implementation
}

export interface PerformanceLog {
  // ... implementation
}

export interface RoadmapProposal {
  // ... implementation
}

export interface OldRoadmapProposal {
  // ... implementation
}

export interface SubmitLessonPayload {
  // ... implementation
}

export interface AIAssessmentResponse {
  // ... implementation
}

–§–∞–π–ª: frontend/src/types/websocket.ts
-------------------------------------
// File: websocket.ts
// Summary of declarations:

export interface StudentSubmittedLessonEvent {
  // ... implementation
}

export interface TeacherReviewedLessonEvent {
  // ... implementation
}

export interface StudentRequestedReviewEvent {
  // ... implementation
}

–§–∞–π–ª: frontend/src/vite-env.d.ts
--------------------------------
// File: vite-env.d.ts
// Summary of declarations:

interface ImportMetaEnv {
  // ... implementation
}

interface ImportMeta {
  // ... implementation
}

–§–∞–π–ª: frontend/tailwind.config.js
---------------------------------
// File: tailwind.config.js
// No top-level declarations found.

–§–∞–π–ª: frontend/tsconfig.json
----------------------------
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "noEmit": true,
    "moduleResolution": "node",
    "resolveJsonModule": true,

[... content truncated ...]

  },
  "include": ["src"],
  "exclude": ["node_modules", "dist"],
  "references": [{ "path": "./tsconfig.node.json" }]
}

–§–∞–π–ª: frontend/tsconfig.node.json
---------------------------------
{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "composite": true,
    "module": "esnext",
    "moduleResolution": "node",
    "target": "ESNext",
    "types": ["node"],
    "allowSyntheticDefaultImports": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "strict": true,
    "noEmit": false
  },
  "include": ["vite.config.ts", "plugins/spa-fallback.ts", "vite-spa-fallback.ts"],
  "exclude": ["node_modules", "dist", "**/*.test.ts"]
}


–§–∞–π–ª: frontend/vite.config.ts
-----------------------------
// File: vite.config.ts
// Summary of declarations:

const __filename = fileURLToPath(import.meta.url);

const __dirname = resolve(__filename, '..');

–§–∞–π–ª: package.json
------------------
{
  "name": "math-quest",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "dev": "concurrently \"npm run backend:dev\" \"npm run frontend:dev\"",
    "backend:dev": "cd backend && npm run dev",
    "frontend:dev": "cd frontend && npm run dev",
    "install:all": "npm install && cd backend && npm install && cd ../frontend && npm install",
    "build": "cd backend && npm run build && cd ../frontend && npm run build",

[... content truncated ...]

  },
  "prisma": {
    "schema": "backend/prisma/schema.prisma"
  }
}

–§–∞–π–ª: sloth_plan.txt
--------------------
–ó–∞–¥–∞—á–∞ –ø–æ–Ω—è—Ç–Ω–∞. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç —É–∑–Ω–∞—Ç—å, –∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç. –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± ‚Äî —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `README.md` —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –∑–∞–ø—É—Å–∫—É. –≠—Ç–æ –±—É–¥–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –¥—Ä—É–≥–∏—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.

**–ü–ª–∞–Ω:**

1.  –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `README.md` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.
2.  –î–æ–±–∞–≤–∏—Ç—å –≤ `README.md` –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤–∫–ª—é—á–∞—é—Ç:
    *   –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ (Node.js, npm, PostgreSQL).
    *   –ü–æ—Ä—è–¥–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã `npm run install:all` –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.
    *   –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Ñ–∞–π–ª–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è `.env` –¥–ª—è –±—ç–∫–µ–Ω–¥–∞.
    *   –ö–æ–º–∞–Ω–¥—É –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: `npm run prisma:migrate`.
    *   –û—Å–Ω–æ–≤–Ω—É—é –∫–æ–º–∞–Ω–¥—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: `npm run dev`.

–¶–µ–ª—å ‚Äî –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –µ–¥–∏–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –æ–Ω —Å–º–æ–∂–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞.
--- –ö–û–ù–ï–¶ –ö–û–ù–¢–ï–ö–°–¢–ê ---
–ó–∞–¥–∞—á–∞: –ù–∞—É—á–∏ –º–µ–Ω—è –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç, –∫–∞–∂–µ—Ç—Å—è —Ç–∞–º –±—ã–ª —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞, –∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å —á—Ç–æ–±—ã –≤—Å–µ —Ä–∞–±–æ—Ç–∞–ª–æ, –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –∏ –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∑–∞–¥–∞—á—É –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å –æ—Ç–≤–µ—Ç, —Å—Ç—Ä–æ–≥–æ —Å–ª–µ–¥—É—è –ø—Ä–∞–≤–∏–ª–∞–º –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.


================================================================================
–û–¢–í–ï–¢ (–°–æ—Å—Ç–æ—è–Ω–∏–µ: EXECUTION, –ò—Ç–µ—Ä–∞—Ü–∏—è: 1)
--------------------------------------------------------------------------------
–Ø –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –µ–≥–æ –∑–∞–ø—É—Å–∫—É. –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± ‚Äî —ç—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `npm run dev` –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏, –Ω–æ –ø–µ—Ä–µ–¥ —ç—Ç–∏–º –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —à–∞–≥–æ–≤ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ.

–Ø —Å–æ–∑–¥–∞–ª —Ñ–∞–π–ª `README.md` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞, –≤ –∫–æ—Ç–æ—Ä–æ–º –ø–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—Å–∞–Ω –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å ‚Äî –æ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–æ –∑–∞–ø—É—Å–∫–∞. –í—ã –º–æ–∂–µ—Ç–µ —Å–ª–µ–¥–æ–≤–∞—Ç—å —ç—Ç–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç.

```write_file path="README.md" boundary="SLOTH_BOUNDARY_070162a1463b4766a0640e529949ed46"
# Tutor Game Project

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏ –∑–∞–ø—É—Å–∫—É –ø—Ä–æ–µ–∫—Ç–∞ Tutor Game –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Å–ª–µ–¥—É—é—â–µ–µ:
*   [Node.js](https://nodejs.org/) (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è v18 –∏–ª–∏ –Ω–æ–≤–µ–µ)
*   [npm](https://www.npmjs.com/) (–æ–±—ã—á–Ω–æ –ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Å Node.js)
*   [PostgreSQL](https://www.postgresql.org/)

–í–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø—É—â–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä PostgreSQL –∏ —Å–æ–∑–¥–∞–Ω–Ω–∞—è –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö.

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏, —á—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–≤–æ—é —Å—Ä–µ–¥—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–µ—Å–ª–∏ –≤—ã –µ—â–µ —ç—Ç–æ–≥–æ –Ω–µ —Å–¥–µ–ª–∞–ª–∏)

```bash
git clone <URL_—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è>
cd tutor-game-new
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –º–æ–Ω–æ—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –ø–∞–∫–µ—Ç–∞–º–∏ `frontend` –∏ `backend`. –ß—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è –æ–±–æ–∏—Ö –ø–∞–∫–µ—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
npm run install:all
```
–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç `node_modules` –∫–∞–∫ –¥–ª—è –±—ç–∫–µ–Ω–¥–∞, —Ç–∞–∫ –∏ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞.

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –±—ç–∫–µ–Ω–¥–∞

–°–µ—Ä–≤–µ—Ä—É –±—ç–∫–µ–Ω–¥–∞ —Ç—Ä–µ–±—É—é—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

1.  –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–∞—Ç–∞–ª–æ–≥ `backend`:
    ```bash
    cd backend
    ```

2.  –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª —Å –ø—Ä–∏–º–µ—Ä–æ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:
    ```bash
    cp .env.example .env
    ```

3.  –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª `.env` –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –∏ –æ–±–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –æ—Å–æ–±–µ–Ω–Ω–æ `DATABASE_URL`, —á—Ç–æ–±—ã –æ–Ω–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –≤–∞—à–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ PostgreSQL.

    **–ü—Ä–∏–º–µ—Ä:**
    ```
    DATABASE_URL="postgresql://YOUR_USERNAME:YOUR_PASSWORD@localhost:5432/YOUR_DATABASE_NAME?schema=public"
    ```
    –ó–∞–º–µ–Ω–∏—Ç–µ `YOUR_USERNAME`, `YOUR_PASSWORD` –∏ `YOUR_DATABASE_NAME` –Ω–∞ –≤–∞—à–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

### 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ `.env`, –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É –¥–∞–Ω–Ω—ã—Ö. –ù–∞—Ö–æ–¥—è—Å—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `backend`, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É:

```bash
npm run prisma:migrate
```
–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞—Å—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –≤–∞—à–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ö–µ–º—ã, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –≤ `prisma/schema.prisma`.

### 5. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

–¢–µ–ø–µ—Ä—å –≤—ã –≥–æ—Ç–æ–≤—ã –∫ –∑–∞–ø—É—Å–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

1.  –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –∫–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–µ–∫—Ç–∞:
    ```bash
    cd ..
    ```

2.  –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä—ã –±—ç–∫–µ–Ω–¥–∞ –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –ø–æ–º–æ—â—å—é –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã:
    ```bash
    npm run dev
    ```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–¥–µ–ª–∞–µ—Ç —Å–ª–µ–¥—É—é—â–µ–µ:
-   –ó–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–µ—Ä –±—ç–∫–µ–Ω–¥–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ `http://localhost:3002`).
-   –ó–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ `http://localhost:5173`).

–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é, –æ—Ç–∫—Ä—ã–≤ `http://localhost:5173` –≤ –≤–∞—à–µ–º –≤–µ–±-–±—Ä–∞—É–∑–µ—Ä–µ.

## –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

–ö—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫ –Ω–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤, –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤ –∫–æ—Ä–Ω–µ–≤–æ–º `package.json`:

-   `npm run dev`: **(–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞)** –ó–∞–ø—É—Å–∫–∞–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –±—ç–∫–µ–Ω–¥ –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
-   `npm run install:all`: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è `frontend` –∏ `backend`.
-   `npm run build`: –°–æ–±–∏—Ä–∞–µ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏ –±—ç–∫–µ–Ω–¥ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.
-   `npm run backend:dev`: –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä –±—ç–∫–µ–Ω–¥–∞.
-   `npm run frontend:dev`: –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞.
SLOTH_BOUNDARY_070162a1463b4766a0640e529949ed46
```
```summary
–Ø —Å–æ–∑–¥–∞–ª —Ñ–∞–π–ª `README.md` –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞. –í —ç—Ç–æ–º —Ñ–∞–π–ª–µ —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è –ø–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ, –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏ –∑–∞–ø—É—Å–∫—É –ø—Ä–æ–µ–∫—Ç–∞. –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ ‚Äî `npm run dev`. –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –≤—Å—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Å—Ç–∞—Ä—Ç–∞.
```
–ì–û–¢–û–í–û
```done_summary
–Ø —Å–æ–∑–¥–∞–ª —Ñ–∞–π–ª README.md —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ –∑–∞–ø—É—Å–∫—É, –∫–∞–∫ –∏ –ø—Ä–æ—Å–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. –≠—Ç–æ—Ç —Ñ–∞–π–ª —Ç–µ–ø–µ—Ä—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å–ª—É–∂–∏—Ç –µ–¥–∏–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —Å—Ç–∞—Ä—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ó–∞–¥–∞—á–∞ —Ä–µ—à–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é.
```


–§–∞–π–ª: sloth_runner.py
---------------------
# –§–∞–π–ª: sloth_runner.py
import subprocess
import platform
import re
import hashlib
import os
from colors import Colors

def get_file_hash(filepath):
    """–í—ã—á–∏—Å–ª—è–µ—Ç SHA256 —Ö—ç—à —Ñ–∞–π–ª–∞."""
    if not os.path.exists(filepath) or os.path.isdir(filepath): return None
    h = hashlib.sha256()
    with open(filepath, 'rb') as f:
        while True:
            chunk = f.read(8192)
            if not chunk: break
            h.update(chunk)
    return h.hexdigest()

def _adapt_commands_for_project_root(s: str) -> str:
    cwd = os.getcwd(); root = os.path.basename(cwd.rstrip(os.sep))
    root_posix = cwd.replace("\\","/").rstrip("/")
    s = re.sub(r'^' + re.escape(root + "/"), '', s, flags=re.MULTILINE)
    s = re.sub(r'([ \t\'"])' + re.escape(root + "/"), r'\1', s)
    s = re.sub(r'^' + re.escape(root_posix + "/"), '', s, flags=re.MULTILINE)
    s = re.sub(r'([ \t\'"])' + re.escape(root_posix + "/"), r'\1', s)
    return s

def execute_commands(commands_str):
    """
    –í—ã–ø–æ–ª–Ω—è–µ—Ç –±–ª–æ–∫ shell-–∫–æ–º–∞–Ω–¥.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ç–µ–∂: (success, failed_command, error_message)
    """
    print(f"{Colors.OKBLUE}  [–î–µ—Ç–∞–ª–∏] –ó–∞–ø—É—Å–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±–ª–æ–∫–∞ –∫–æ–º–∞–Ω–¥...{Colors.ENDC}")

    # –ò–ó–ú–ï–ù–ï–ù–û: –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–∏—Å–∫–∞ –ø—É—Ç–µ–π, –≤–∫–ª—é—á–∞—è —Ç–µ, —á—Ç–æ –≤ –∫–∞–≤—ã—á–∫–∞—Ö
    filepaths = re.findall(r'[\'"]?([a-zA-Z0-9_\-\.\/]+)[\'"]?', commands_str)
    
    # –°–æ–±–∏—Ä–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –î–û –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥
    hashes_before = {fp: get_file_hash(fp) for fp in filepaths if os.path.isfile(fp)}
    dirs_before = {fp for fp in filepaths if os.path.isdir(fp)}
    files_before = {fp for fp in filepaths if os.path.exists(fp)} # –í—Å–µ –ø—É—Ç–∏, –≤–∫–ª—é—á–∞—è –ø–∞–ø–∫–∏
    
    try:
        is_macos = platform.system() == "Darwin"
        # –ß–∏—Å—Ç–∏–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ –≤ –ø—É—Ç—è—Ö
        commands_str_fixed = _adapt_commands_for_project_root(commands_str)
        # –î–ª—è macOS –¥–æ–±–∞–≤–ª—è–µ–º —Ñ–ª–∞–≥ .bak –¥–ª—è sed -i, —á—Ç–æ–±—ã –æ–Ω —Ä–∞–±–æ—Ç–∞–ª –∫–∞–∫ –≤ Linux
        commands_str_adapted = re.sub(r"sed -i ", "sed -i '.bak' ", commands_str_fixed) if is_macos else commands_str_fixed
        full_command = f"set -e\n{commands_str_adapted}"

        print(f"{Colors.WARNING}‚ö°Ô∏è –õ–û–ì: –í—ã–ø–æ–ª–Ω—è—é –±–ª–æ–∫ –∫–æ–º–∞–Ω–¥ (bash, set -e)...{Colors.ENDC}")
        result = subprocess.run(['bash', '-c', full_command], capture_output=True, text=True, encoding='utf-8')

        if result.returncode != 0:
            error_msg = f"–ö–æ–º–∞–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —Å –Ω–µ–Ω—É–ª–µ–≤—ã–º –∫–æ–¥–æ–º –≤—ã—Ö–æ–¥–∞ ({result.returncode}).\n–û—à–∏–±–∫–∞ (STDERR): {result.stderr.strip()}"
            print(f"{Colors.FAIL}‚ùå –õ–û–ì: –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –±–ª–æ–∫–∞ –∫–æ–º–∞–Ω–¥.\n{error_msg}{Colors.ENDC}")
            return False, commands_str, result.stderr.strip() or "–ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å –±–µ–∑ –≤—ã–≤–æ–¥–∞ –≤ stderr."

        if result.stderr:
            print(f"{Colors.WARNING}‚ö†Ô∏è  –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï (STDERR –æ—Ç —É—Å–ø–µ—à–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã):\n{result.stderr.strip()}{Colors.ENDC}")

        # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã .bak, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ sed –Ω–∞ macOS
        if is_macos:
            subprocess.run("find . -name '*.bak' -delete", shell=True, check=True, capture_output=True)

        # --- –ù–û–í–ê–Ø, –ë–û–õ–ï–ï –ù–ê–î–ï–ñ–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ò–ó–ú–ï–ù–ï–ù–ò–ô ---
        hashes_after = {fp: get_file_hash(fp) for fp in hashes_before.keys()}
        files_after = {fp for fp in filepaths if os.path.exists(fp)}

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª—Å—è –ª–∏ —Ö—ç—à —É —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤
        modified_files = any(hashes_before.get(fp) != hashes_after.get(fp) for fp in hashes_before)
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ—è–≤–∏–ª–∏—Å—å –ª–∏ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –∏–ª–∏ –ø–∞–ø–∫–∏
        created_paths = files_after - files_before
        
        if not modified_files and not created_paths:
            # –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –∏ –Ω–µ —Å–æ–∑–¥–∞–ª–æ—Å—å - —ç—Ç–æ –æ—à–∏–±–∫–∞ –ª–æ–≥–∏–∫–∏
            error_msg = ("–ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å —É—Å–ø–µ—à–Ω–æ, –Ω–æ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞ –∏ –Ω–µ —Å–æ–∑–¥–∞–ª–∞ –Ω–∏ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –∏–ª–∏ –ø–∞–ø–∫–∏. "
                         "–í–µ—Ä–æ—è—Ç–Ω–æ, —à–∞–±–ª–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ sed) –Ω–µ –±—ã–ª –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –Ω–µ–≤–µ—Ä–µ–Ω.")
            final_error_message = result.stderr.strip() if result.stderr else error_msg
            print(f"{Colors.FAIL}‚ùå –õ–û–ì: –û–®–ò–ë–ö–ê –õ–û–ì–ò–ö–ò: {error_msg}{Colors.ENDC}")
            if result.stderr:
                print(f"–ü—Ä–∏—á–∏–Ω–∞ –∏–∑ STDERR: {final_error_message}")
            return False, commands_str, final_error_message

        # –ï—Å–ª–∏ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏—è, –≤—Å–µ —Ö–æ—Ä–æ—à–æ
        if modified_files:
            print(f"{Colors.OKGREEN}‚úÖ –õ–û–ì: –ë–ª–æ–∫ –∫–æ–º–∞–Ω–¥ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω. –§–∞–π–ª—ã –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã.{Colors.ENDC}")
        if created_paths:
            print(f"{Colors.OKGREEN}‚úÖ –õ–û–ì: –ë–ª–æ–∫ –∫–æ–º–∞–Ω–¥ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω. –ë—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –Ω–æ–≤—ã–µ –ø—É—Ç–∏: {', '.join(created_paths)}{Colors.ENDC}")
            
        return True, None, None

    except Exception as e:
        print(f"{Colors.FAIL}‚ùå –õ–û–ì: –ù–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –û–®–ò–ë–ö–ê –≤ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ: {e}{Colors.ENDC}")
        return False, commands_str, str(e)